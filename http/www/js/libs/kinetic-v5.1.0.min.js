var Kinetic={};(function(a){var b=Math.PI/180;Kinetic={version:"5.1.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:false,inDblClickWindow:false,enableTrace:false,traceArrMax:100,dblClickWindow:400,pixelRatio:undefined,dragDistance:0,angleDeg:true,UA:(function(){var f=(a.navigator&&a.navigator.userAgent)||"";var e=f.toLowerCase(),d=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],c=!!(f.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i));return{browser:d[1]||"",version:d[2]||"0",mobile:c}})(),Filters:{},Node:function(c){this._init(c)},Shape:function(c){this.__init(c)},Container:function(c){this.__init(c)},Stage:function(c){this.___init(c)},BaseLayer:function(c){this.___init(c)},Layer:function(c){this.____init(c)},FastLayer:function(c){this.____init(c)},Group:function(c){this.___init(c)},isDragging:function(){var c=Kinetic.DD;if(!c){return false}else{return c.isDragging}},isDragReady:function(){var c=Kinetic.DD;if(!c){return false}else{return !!c.node}},_addId:function(c,d){if(d!==undefined){this.ids[d]=c}},_removeId:function(c){if(c!==undefined){delete this.ids[c]}},_addName:function(d,c){if(c!==undefined){if(this.names[c]===undefined){this.names[c]=[]}this.names[c].push(d)}},_removeName:function(d,e){if(d!==undefined){var c=this.names[d];if(c!==undefined){for(var g=0;g<c.length;g++){var f=c[g];if(f._id===e){c.splice(g,1)}}if(c.length===0){delete this.names[d]}}}},getAngle:function(c){return this.angleDeg?c*b:c}}})(this);(function(b,c){if(typeof exports==="object"){var a=require("canvas");var d=require("jsdom").jsdom;var f=d("<!DOCTYPE html><html><head></head><body></body></html>");var e=c();Kinetic.document=f;Kinetic.window=Kinetic.document.createWindow();Kinetic.window.Image=a.Image;Kinetic.root=b;Kinetic._nodeCanvas=a;module.exports=e;return}else{if(typeof define==="function"&&define.amd){define(c)}}Kinetic.document=document;Kinetic.window=window;Kinetic.root=b}((1,eval)("this"),function(){return Kinetic}));(function(){Kinetic.Collection=function(){var p=[].slice.call(arguments),r=p.length,q=0;this.length=r;for(;q<r;q++){this[q]=p[q]}return this};Kinetic.Collection.prototype=[];Kinetic.Collection.prototype.each=function(p){for(var q=0;q<this.length;q++){p(this[q],q)}};Kinetic.Collection.prototype.toArray=function(){var q=[],p=this.length,r;for(r=0;r<p;r++){q.push(this[r])}return q};Kinetic.Collection.toCollection=function(q){var r=new Kinetic.Collection(),p=q.length,s;for(s=0;s<p;s++){r.push(q[s])}return r};Kinetic.Collection._mapMethod=function(p){Kinetic.Collection.prototype[p]=function(){var q=this.length,s;var r=[].slice.call(arguments);for(s=0;s<q;s++){this[s][p].apply(this[s],r)}return this}};Kinetic.Collection.mapMethods=function(q){var r=q.prototype;for(var p in r){Kinetic.Collection._mapMethod(p)}};Kinetic.Transform=function(p){this.m=(p&&p.slice())||[1,0,0,1,0,0]};Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(r){var q=this.m;return{x:q[0]*r.x+q[2]*r.y+q[4],y:q[1]*r.x+q[3]*r.y+q[5]}},translate:function(p,q){this.m[4]+=this.m[0]*p+this.m[2]*q;this.m[5]+=this.m[1]*p+this.m[3]*q;return this},scale:function(q,p){this.m[0]*=q;this.m[1]*=q;this.m[2]*=p;this.m[3]*=p;return this},rotate:function(p){var w=Math.cos(p);var q=Math.sin(p);var t=this.m[0]*w+this.m[2]*q;var r=this.m[1]*w+this.m[3]*q;var v=this.m[0]*-q+this.m[2]*w;var u=this.m[1]*-q+this.m[3]*w;this.m[0]=t;this.m[1]=r;this.m[2]=v;this.m[3]=u;return this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(u,s){var q=this.m[0]+this.m[2]*s;var p=this.m[1]+this.m[3]*s;var t=this.m[2]+this.m[0]*u;var r=this.m[3]+this.m[1]*u;this.m[0]=q;this.m[1]=p;this.m[2]=t;this.m[3]=r;return this},multiply:function(r){var t=this.m[0]*r.m[0]+this.m[2]*r.m[1];var s=this.m[1]*r.m[0]+this.m[3]*r.m[1];var v=this.m[0]*r.m[2]+this.m[2]*r.m[3];var u=this.m[1]*r.m[2]+this.m[3]*r.m[3];var q=this.m[0]*r.m[4]+this.m[2]*r.m[5]+this.m[4];var p=this.m[1]*r.m[4]+this.m[3]*r.m[5]+this.m[5];this.m[0]=t;this.m[1]=s;this.m[2]=v;this.m[3]=u;this.m[4]=q;this.m[5]=p;return this},invert:function(){var u=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]);var t=this.m[3]*u;var s=-this.m[1]*u;var r=-this.m[2]*u;var q=this.m[0]*u;var p=u*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);var v=u*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t;this.m[1]=s;this.m[2]=r;this.m[3]=q;this.m[4]=p;this.m[5]=v;return this},getMatrix:function(){return this.m},setAbsolutePosition:function(s,q){var A=this.m[0],z=this.m[1],w=this.m[2],v=this.m[3],t=this.m[4],r=this.m[5],u=((A*(q-r))-(z*(s-t)))/((A*v)-(z*w)),p=(s-t-(w*u))/A;return this.translate(p,u)}};var m="canvas",c="2d",o="[object Array]",b="[object Number]",g="[object String]",k=Math.PI/180,l=180/Math.PI,h="#",a="",i="0",e="Kinetic warning: ",n="Kinetic error: ",f="rgb(",j={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(p){return !!(p&&p.nodeType==1)},_isFunction:function(p){return !!(p&&p.constructor&&p.call&&p.apply)},_isObject:function(p){return(!!p&&p.constructor==Object)},_isArray:function(p){return Object.prototype.toString.call(p)==o},_isNumber:function(p){return Object.prototype.toString.call(p)==b},_isString:function(p){return Object.prototype.toString.call(p)==g},_throttle:function(q,s,w){var p,u,x;var v=null;var t=0;w||(w={});var r=function(){t=w.leading===false?0:new Date().getTime();v=null;x=q.apply(p,u);p=u=null};return function(){var y=new Date().getTime();if(!t&&w.leading===false){t=y}var z=s-(y-t);p=this;u=arguments;if(z<=0){clearTimeout(v);v=null;t=y;x=q.apply(p,u);p=u=null}else{if(!v&&w.trailing!==false){v=setTimeout(r,z)}}return x}},_hasMethods:function(r){var q=[],p;for(p in r){if(this._isFunction(r[p])){q.push(p)}}return q.length>0},createCanvasElement:function(){var p=Kinetic.document.createElement("canvas");p.style=p.style||{};return p},isBrowser:function(){return(typeof exports!=="object")},_isInDocument:function(p){while(p=p.parentNode){if(p==Kinetic.document){return true}}return false},_simplifyArray:function(q){var u=[],p=q.length,r=Kinetic.Util,t,s;for(t=0;t<p;t++){s=q[t];if(r._isNumber(s)){s=Math.round(s*1000)/1000}else{if(!r._isString(s)){s=s.toString()}}u.push(s)}return u},_getImage:function(p,t){var s,r;if(!p){t(null)}else{if(this._isElement(p)){t(p)}else{if(this._isString(p)){s=new Kinetic.window.Image();s.onload=function(){t(s)};s.src=p}else{if(p.data){r=Kinetic.Util.createCanvasElement();r.width=p.width;r.height=p.height;var q=r.getContext(c);q.putImageData(p,0,0);this._getImage(r.toDataURL(),t)}else{t(null)}}}}},_getRGBAString:function(t){var s=t.red||0,q=t.green||0,p=t.blue||0,r=t.alpha||1;return["rgba(",s,",",q,",",p,",",r,")"].join(a)},_rgbToHex:function(s,q,p){return((1<<24)+(s<<16)+(q<<8)+p).toString(16).slice(1)},_hexToRgb:function(p){p=p.replace(h,a);var q=parseInt(p,16);return{r:(q>>16)&255,g:(q>>8)&255,b:q&255}},getRandomColor:function(){var p=(Math.random()*16777215<<0).toString(16);while(p.length<6){p=i+p}return h+p},get:function(q,p){if(q===undefined){return p}else{return q}},getRGB:function(p){var q;if(p in j){q=j[p];return{r:q[0],g:q[1],b:q[2]}}else{if(p[0]===h){return this._hexToRgb(p.substring(1))}else{if(p.substr(0,4)===f){q=d.exec(p.replace(/ /g,""));return{r:parseInt(q[1],10),g:parseInt(q[2],10),b:parseInt(q[3],10)}}else{return{r:0,g:0,b:0}}}}},_merge:function(s,q){var r=this._clone(q);for(var p in s){if(this._isObject(s[p])){r[p]=this._merge(s[p],r[p])}else{r[p]=s[p]}}return r},cloneObject:function(r){var q={};for(var p in r){if(this._isObject(r[p])){q[p]=this.cloneObject(r[p])}else{if(this._isArray(r[p])){q[p]=this.cloneArray(r[p])}else{q[p]=r[p]}}}return q},cloneArray:function(p){return p.slice(0)},_degToRad:function(p){return p*k},_radToDeg:function(p){return p*l},_capitalize:function(p){return p.charAt(0).toUpperCase()+p.slice(1)},error:function(p){throw new Error(n+p)},warn:function(p){if(Kinetic.root.console&&console.warn){console.warn(e+p)}},extend:function(r,q){for(var p in q.prototype){if(!(p in r.prototype)){r.prototype[p]=q.prototype[p]}}},addMethods:function(r,p){var q;for(q in p){r.prototype[q]=p[q]}},_getControlPoints:function(u,C,s,B,r,A,E){var D=Math.sqrt(Math.pow(s-u,2)+Math.pow(B-C,2)),x=Math.sqrt(Math.pow(r-s,2)+Math.pow(A-B,2)),w=E*D/(D+x),v=E*x/(D+x),q=s-w*(r-u),p=B-w*(A-C),z=s+v*(r-u),y=B+v*(A-C);return[q,p,z,y]},_expandPoints:function(u,s){var q=u.length,r=[],v,t;for(v=2;v<q-2;v+=2){t=Kinetic.Util._getControlPoints(u[v-2],u[v-1],u[v],u[v+1],u[v+2],u[v+3],s);r.push(t[0]);r.push(t[1]);r.push(u[v]);r.push(u[v+1]);r.push(t[2]);r.push(t[3])}return r},_removeLastLetter:function(p){return p.substring(0,p.length-1)}}})();(function(){var a=Kinetic.Util.createCanvasElement(),b=a.getContext("2d"),c=Kinetic.UA.mobile?(function(){var d=window.devicePixelRatio||1,e=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;return d/e})():1;Kinetic.Canvas=function(d){this.init(d)};Kinetic.Canvas.prototype={init:function(d){d=d||{};var e=d.pixelRatio||Kinetic.pixelRatio||c;this.pixelRatio=e;this._canvas=Kinetic.Util.createCanvasElement();this._canvas.style.padding=0;this._canvas.style.margin=0;this._canvas.style.border=0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(d){this.pixelRatio=d;this.setSize(this.getWidth(),this.getHeight())},setWidth:function(d){this.width=this._canvas.width=d*this.pixelRatio;this._canvas.style.width=d+"px"},setHeight:function(d){this.height=this._canvas.height=d*this.pixelRatio;this._canvas.style.height=d+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,d){this.setWidth(e);this.setHeight(d)},toDataURL:function(g,h){try{return this._canvas.toDataURL(g,h)}catch(f){try{return this._canvas.toDataURL()}catch(d){Kinetic.Util.warn("Unable to get data URL. "+d.message);return""}}}};Kinetic.SceneCanvas=function(e){e=e||{};var f=e.width||0,d=e.height||0;Kinetic.Canvas.call(this,e);this.context=new Kinetic.SceneContext(this);this.setSize(f,d)};Kinetic.SceneCanvas.prototype={setWidth:function(e){var f=this.pixelRatio,d=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,e);d.scale(f,f)},setHeight:function(d){var f=this.pixelRatio,e=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,d);e.scale(f,f)}};Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas);Kinetic.HitCanvas=function(e){e=e||{};e.pixelRatio=1;var f=e.width||0,d=e.height||0;Kinetic.Canvas.call(this,e);this.context=new Kinetic.HitContext(this);this.setSize(f,d)};Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)})();(function(){var d=",",c="(",i=")",f="([",a="])",e=";",b="()",g="=",h=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(j){this.init(j)};Kinetic.Context.prototype={init:function(j){this.canvas=j;this._context=j._canvas.getContext("2d");if(Kinetic.enableTrace){this.traceArr=[];this._enableTrace()}},fillShape:function(j){if(j.getFillEnabled()){this._fill(j)}},strokeShape:function(j){if(j.getStrokeEnabled()){this._stroke(j)}},fillStrokeShape:function(k){var j=k.getFillEnabled();if(j){this._fill(k)}if(k.getStrokeEnabled()){this._stroke(k)}},getTrace:function(l){var o=this.traceArr,j=o.length,p="",r,m,q,k;for(r=0;r<j;r++){m=o[r];q=m.method;if(q){k=m.args;p+=q;if(l){p+=b}else{if(Kinetic.Util._isArray(k[0])){p+=f+k.join(d)+a}else{p+=c+k.join(d)+i}}}else{p+=m.property;if(!l){p+=g+m.val}}p+=e}return p},clearTrace:function(){this.traceArr=[]},_trace:function(l){var k=this.traceArr,j;k.push(l);j=k.length;if(j>=Kinetic.traceArrMax){k.shift()}},reset:function(){var j=this.getCanvas().getPixelRatio();this.setTransform(1*j,0,0,1*j,0,0)},getCanvas:function(){return this.canvas},clear:function(k){var j=this.getCanvas();if(k){this.clearRect(k.x||0,k.y||0,k.width||0,k.height||0)}else{this.clearRect(0,0,j.getWidth(),j.getHeight())}},_applyLineCap:function(j){var k=j.getLineCap();if(k){this.setAttr("lineCap",k)}},_applyOpacity:function(j){var k=j.getAbsoluteOpacity();if(k!==1){this.setAttr("globalAlpha",k)}},_applyLineJoin:function(k){var j=k.getLineJoin();if(j){this.setAttr("lineJoin",j)}},setAttr:function(j,k){this._context[j]=k},arc:function(){var j=arguments;this._context.arc(j[0],j[1],j[2],j[3],j[4],j[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var j=arguments;this._context.bezierCurveTo(j[0],j[1],j[2],j[3],j[4],j[5])},clearRect:function(){var j=arguments;this._context.clearRect(j[0],j[1],j[2],j[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var j=arguments;if(j.length===2){return this._context.createImageData(j[0],j[1])}else{if(j.length===1){return this._context.createImageData(j[0])}}},createLinearGradient:function(){var j=arguments;return this._context.createLinearGradient(j[0],j[1],j[2],j[3])},createPattern:function(){var j=arguments;return this._context.createPattern(j[0],j[1])},createRadialGradient:function(){var j=arguments;return this._context.createRadialGradient(j[0],j[1],j[2],j[3],j[4],j[5])},drawImage:function(){var k=arguments,j=this._context;if(k.length===3){j.drawImage(k[0],k[1],k[2])}else{if(k.length===5){j.drawImage(k[0],k[1],k[2],k[3],k[4])}else{if(k.length===9){j.drawImage(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],k[8])}}}},fill:function(){this._context.fill()},fillText:function(){var j=arguments;this._context.fillText(j[0],j[1],j[2])},getImageData:function(){var j=arguments;return this._context.getImageData(j[0],j[1],j[2],j[3])},lineTo:function(){var j=arguments;this._context.lineTo(j[0],j[1])},moveTo:function(){var j=arguments;this._context.moveTo(j[0],j[1])},rect:function(){var j=arguments;this._context.rect(j[0],j[1],j[2],j[3])},putImageData:function(){var j=arguments;this._context.putImageData(j[0],j[1],j[2])},quadraticCurveTo:function(){var j=arguments;this._context.quadraticCurveTo(j[0],j[1],j[2],j[3])},restore:function(){this._context.restore()},rotate:function(){var j=arguments;this._context.rotate(j[0])},save:function(){this._context.save()},scale:function(){var j=arguments;this._context.scale(j[0],j[1])},setLineDash:function(){var k=arguments,j=this._context;if(this._context.setLineDash){j.setLineDash(k[0])}else{if("mozDash" in j){j.mozDash=k[0]}else{if("webkitLineDash" in j){j.webkitLineDash=k[0]}}}},setTransform:function(){var j=arguments;this._context.setTransform(j[0],j[1],j[2],j[3],j[4],j[5])},stroke:function(){this._context.stroke()},strokeText:function(){var j=arguments;this._context.strokeText(j[0],j[1],j[2])},transform:function(){var j=arguments;this._context.transform(j[0],j[1],j[2],j[3],j[4],j[5])},translate:function(){var j=arguments;this._context.translate(j[0],j[1])},_enableTrace:function(){var o=this,j=h.length,l=Kinetic.Util._simplifyArray,p=this.setAttr,q,k;var m=function(n){var s=o[n],r;o[n]=function(){k=l(Array.prototype.slice.call(arguments,0));r=s.apply(o,arguments);o._trace({method:n,args:k});return r}};for(q=0;q<j;q++){m(h[q])}o.setAttr=function(){p.apply(o,arguments);o._trace({property:arguments[0],val:arguments[1]})}}};Kinetic.SceneContext=function(j){Kinetic.Context.call(this,j)};Kinetic.SceneContext.prototype={_fillColor:function(j){var k=j.fill()||Kinetic.Util._getRGBAString({red:j.fillRed(),green:j.fillGreen(),blue:j.fillBlue(),alpha:j.fillAlpha()});this.setAttr("fillStyle",k);j._fillFunc(this)},_fillPattern:function(j){var p=j.getFillPatternImage(),l=j.getFillPatternX(),k=j.getFillPatternY(),q=j.getFillPatternScale(),o=Kinetic.getAngle(j.getFillPatternRotation()),n=j.getFillPatternOffset(),m=j.getFillPatternRepeat();if(l||k){this.translate(l||0,k||0)}if(o){this.rotate(o)}if(q){this.scale(q.x,q.y)}if(n){this.translate(-1*n.x,-1*n.y)}this.setAttr("fillStyle",this.createPattern(p,m||"repeat"));this.fill()},_fillLinearGradient:function(m){var p=m.getFillLinearGradientStartPoint(),k=m.getFillLinearGradientEndPoint(),l=m.getFillLinearGradientColorStops(),j=this.createLinearGradient(p.x,p.y,k.x,k.y);if(l){for(var o=0;o<l.length;o+=2){j.addColorStop(l[o],l[o+1])}this.setAttr("fillStyle",j);this.fill()}},_fillRadialGradient:function(o){var r=o.getFillRadialGradientStartPoint(),k=o.getFillRadialGradientEndPoint(),m=o.getFillRadialGradientStartRadius(),p=o.getFillRadialGradientEndRadius(),l=o.getFillRadialGradientColorStops(),j=this.createRadialGradient(r.x,r.y,m,k.x,k.y,p);for(var q=0;q<l.length;q+=2){j.addColorStop(l[q],l[q+1])}this.setAttr("fillStyle",j);this.fill()},_fill:function(k){var o=k.fill()||k.fillRed()||k.fillGreen()||k.fillBlue(),j=k.getFillPatternImage(),m=k.getFillLinearGradientColorStops(),l=k.getFillRadialGradientColorStops(),n=k.getFillPriority();if(o&&n==="color"){this._fillColor(k)}else{if(j&&n==="pattern"){this._fillPattern(k)}else{if(m&&n==="linear-gradient"){this._fillLinearGradient(k)}else{if(l&&n==="radial-gradient"){this._fillRadialGradient(k)}else{if(o){this._fillColor(k)}else{if(j){this._fillPattern(k)}else{if(m){this._fillLinearGradient(k)}else{if(l){this._fillRadialGradient(k)}}}}}}}}},_stroke:function(j){var l=j.dash(),k=j.getStrokeScaleEnabled();if(j.hasStroke()){if(!k){this.save();this.setTransform(1,0,0,1,0,0)}this._applyLineCap(j);if(l&&j.dashEnabled()){this.setLineDash(l)}this.setAttr("lineWidth",j.strokeWidth());this.setAttr("strokeStyle",j.stroke()||Kinetic.Util._getRGBAString({red:j.strokeRed(),green:j.strokeGreen(),blue:j.strokeBlue(),alpha:j.strokeAlpha()}));j._strokeFunc(this);if(!k){this.restore()}}},_applyShadow:function(m){var k=Kinetic.Util,n=m.getAbsoluteOpacity(),l=k.get(m.getShadowColor(),"black"),p=k.get(m.getShadowBlur(),5),j=k.get(m.getShadowOpacity(),1),o=k.get(m.getShadowOffset(),{x:0,y:0});if(j){this.setAttr("globalAlpha",j*n)}this.setAttr("shadowColor",l);this.setAttr("shadowBlur",p);this.setAttr("shadowOffsetX",o.x);this.setAttr("shadowOffsetY",o.y)}};Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context);Kinetic.HitContext=function(j){Kinetic.Context.call(this,j)};Kinetic.HitContext.prototype={_fill:function(j){this.save();this.setAttr("fillStyle",j.colorKey);j._fillFuncHit(this);this.restore()},_stroke:function(j){if(j.hasStroke()){this._applyLineCap(j);this.setAttr("lineWidth",j.strokeWidth());this.setAttr("strokeStyle",j.colorKey);j._strokeFuncHit(this)}}};Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)})();(function(){var v="absoluteOpacity",E="absoluteTransform",z="add",m="b",j="before",N="black",D="Change",q="children",L="Deg",s=".",k="",i="g",p="get",h="#",t="id",C="kinetic",e="listening",f="mouseenter",n="mouseleave",F="name",l="off",r="on",K="_get",g="r",H="RGB",P="set",u="Shape",a=" ",o="Stage",M="transform",J="B",I="G",b="Height",A="R",y="Width",x="X",w="Y",O="visible",d="x",c="y";Kinetic.Factory={addGetterSetter:function(Q,B,R,G,S){this.addGetter(Q,B,R);this.addSetter(Q,B,G,S);this.addOverloadedGetterSetter(Q,B)},addGetter:function(G,B,Q){var R=p+Kinetic.Util._capitalize(B);G.prototype[R]=function(){var S=this.attrs[B];return S===undefined?Q:S}},addSetter:function(Q,B,G,R){var S=P+Kinetic.Util._capitalize(B);Q.prototype[S]=function(T){if(G){T=G.call(this,T)}this._setAttr(B,T);if(R){R.call(this)}return this}},addComponentsGetterSetter:function(R,W,T,G,B){var V=T.length,U=Kinetic.Util._capitalize,X=p+U(W),S=P+U(W),Q,Y;R.prototype[X]=function(){var Z={};for(Q=0;Q<V;Q++){Y=T[Q];Z[Y]=this.getAttr(W+U(Y))}return Z};R.prototype[S]=function(ab){var Z=this.attrs[W],aa;if(G){ab=G.call(this,ab)}for(aa in ab){this._setAttr(W+U(aa),ab[aa])}this._fireChangeEvent(W,Z,ab);if(B){B.call(this)}return this};this.addOverloadedGetterSetter(R,W)},addOverloadedGetterSetter:function(Q,G){var R=Kinetic.Util._capitalize(G),S=P+R,B=p+R;Q.prototype[G]=function(){if(arguments.length){this[S](arguments[0]);return this}else{return this[B]()}}},backCompat:function(Q,B){var G;for(G in B){Q.prototype[G]=Q.prototype[B[G]]}},afterSetFilter:function(){this._filterUpToDate=false}};Kinetic.Validators={RGBComponent:function(B){if(B>255){return 255}else{if(B<0){return 0}else{return Math.round(B)}}},alphaComponent:function(B){if(B>1){return 1}else{if(B<0.0001){return 0.0001}else{return B}}}}})();(function(){var c="absoluteOpacity",n="absoluteTransform",m="before",l="Change",e="children",r=".",a="",w="get",i="id",s="kinetic",k="listening",u="mouseenter",g="mouseleave",f="name",o="set",q="Shape",j=" ",h="stage",d="transform",v="Stage",t="visible",p=["id"],b=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(j);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(x){var y=this;this._id=Kinetic.idCounter++;this.eventListeners={};this.attrs={};this._cache={};this._filterUpToDate=false;this.setAttrs(x);this.on(b,function(){this._clearCache(d);y._clearSelfAndDescendantCache(n)});this.on("visibleChange.kinetic",function(){y._clearSelfAndDescendantCache(t)});this.on("listeningChange.kinetic",function(){y._clearSelfAndDescendantCache(k)});this.on("opacityChange.kinetic",function(){y._clearSelfAndDescendantCache(c)})},_clearCache:function(x){if(x){delete this._cache[x]}else{this._cache={}}},_getCache:function(x,z){var y=this._cache[x];if(y===undefined){this._cache[x]=z.call(this)}return this._cache[x]},_clearSelfAndDescendantCache:function(x){this._clearCache(x);if(this.children){this.getChildren().each(function(y){y._clearSelfAndDescendantCache(x)})}},clearCache:function(){delete this._cache.canvas;this._filterUpToDate=false;return this},cache:function(D){var H=D||{},L=H.x||0,J=H.y||0,C=H.width||this.width(),M=H.height||this.height(),N=H.drawBorder||false,F=this.getLayer();if(C===0||M===0){Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");return}var z=new Kinetic.SceneCanvas({pixelRatio:1,width:C,height:M}),O=new Kinetic.SceneCanvas({pixelRatio:1,width:C,height:M}),E=new Kinetic.HitCanvas({width:C,height:M}),B=this.transformsEnabled(),K=this.x(),I=this.y(),G=z.getContext(),A=E.getContext();this.clearCache();G.save();A.save();if(N){G.save();G.beginPath();G.rect(0,0,C,M);G.closePath();G.setAttr("strokeStyle","red");G.setAttr("lineWidth",5);G.stroke();G.restore()}G.translate(L*-1,J*-1);A.translate(L*-1,J*-1);if(this.nodeType==="Shape"){G.translate(this.x()*-1,this.y()*-1);A.translate(this.x()*-1,this.y()*-1)}this.drawScene(z,this);this.drawHit(E,this);G.restore();A.restore();this._cache.canvas={scene:z,filter:O,hit:E};return this},_drawCachedSceneCanvas:function(x){x.save();this.getLayer()._applyTransform(this,x);x.drawImage(this._getCachedSceneCanvas()._canvas,0,0);x.restore()},_getCachedSceneCanvas:function(){var z=this.filters(),C=this._cache.canvas,D=C.scene,B=C.filter,E=B.getContext(),F,x,A,y;if(z){if(!this._filterUpToDate){try{F=z.length;E.clear();E.drawImage(D._canvas,0,0);x=E.getImageData(0,0,B.getWidth(),B.getHeight());for(A=0;A<F;A++){y=z[A];y.call(this,x);E.putImageData(x,0,0)}}catch(G){Kinetic.Util.warn("Unable to apply filter. "+G.message)}this._filterUpToDate=true}return B}else{return D}},_drawCachedHitCanvas:function(x){var y=this._cache.canvas,z=y.hit;x.save();this.getLayer()._applyTransform(this,x);x.drawImage(z._canvas,0,0);x.restore()},on:function(A,E){var F=A.split(j),D=F.length,z,y,C,B,x;for(z=0;z<D;z++){y=F[z];C=y.split(r);B=C[0];x=C[1]||a;if(!this.eventListeners[B]){this.eventListeners[B]=[]}this.eventListeners[B].push({name:x,handler:E})}return this},off:function(A){var E=A.split(j),D=E.length,z,F,y,C,B,x;for(z=0;z<D;z++){y=E[z];C=y.split(r);B=C[0];x=C[1];if(B){if(this.eventListeners[B]){this._off(B,x)}}else{for(F in this.eventListeners){this._off(F,x)}}}return this},dispatchEvent:function(x){var y={target:this,type:x.type,evt:x};this.fire(x.type,y)},addEventListener:function(y,x){this.on(y,function(z){x.call(this,z.evt)})},remove:function(){var x=this.getParent();if(x&&x.children){x.children.splice(this.index,1);x._setChildrenIndices();delete this.parent}this._clearSelfAndDescendantCache(h);this._clearSelfAndDescendantCache(n);this._clearSelfAndDescendantCache(t);this._clearSelfAndDescendantCache(k);this._clearSelfAndDescendantCache(c);return this},destroy:function(){Kinetic._removeId(this.getId());Kinetic._removeName(this.getName(),this._id);this.remove()},getAttr:function(x){var y=w+Kinetic.Util._capitalize(x);if(Kinetic.Util._isFunction(this[y])){return this[y]()}else{return this.attrs[x]}},getAncestors:function(){var y=this.getParent(),x=new Kinetic.Collection();while(y){x.push(y);y=y.getParent()}return x},getAttrs:function(){return this.attrs||{}},setAttrs:function(x){var y,z;if(x){for(y in x){if(y===e){}else{z=o+Kinetic.Util._capitalize(y);if(Kinetic.Util._isFunction(this[z])){this[z](x[y])}else{this._setAttr(y,x[y])}}}}return this},isListening:function(){return this._getCache(k,this._isListening)},_isListening:function(){var x=this.getListening(),y=this.getParent();if(x==="inherit"){if(y){return y.isListening()}else{return true}}else{return x}},isVisible:function(){return this._getCache(t,this._isVisible)},_isVisible:function(){var y=this.getVisible(),x=this.getParent();if(y==="inherit"){if(x){return x.isVisible()}else{return true}}else{return y}},shouldDrawHit:function(){var x=this.getLayer();return x&&x.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){this.setVisible(true);return this},hide:function(){this.setVisible(false);return this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){var C=this.getDepth(),B=this,A=0,z,x,E,D;function y(F){z=[];x=F.length;for(E=0;E<x;E++){D=F[E];A++;if(D.nodeType!==q){z=z.concat(D.getChildren().toArray())}if(D._id===B._id){E=x}}if(z.length>0&&z[0].getDepth()<=C){y(z)}}if(B.nodeType!==v){y(B.getStage().getChildren())}return A},getDepth:function(){var y=0,x=this.parent;while(x){y++;x=x.parent}return y},setPosition:function(x){this.setX(x.x);this.setY(x.y);return this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var x=this.getAbsoluteTransform().getMatrix(),z=new Kinetic.Transform(),y=this.offset();z.m=x.slice();z.translate(y.x,y.y);return z.getTranslation()},setAbsolutePosition:function(z){var y=this._clearTransform(),x;this.attrs.x=y.x;this.attrs.y=y.y;delete y.x;delete y.y;x=this.getAbsoluteTransform();x.invert();x.translate(z.x,z.y);z={x:this.attrs.x+x.getTranslation().x,y:this.attrs.y+x.getTranslation().y};this.setPosition({x:z.x,y:z.y});this._setTransform(y);return this},_setTransform:function(y){var x;for(x in y){this.attrs[x]=y[x]}this._clearCache(d);this._clearSelfAndDescendantCache(n)},_clearTransform:function(){var x={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache(d);this._clearSelfAndDescendantCache(n);return x},move:function(D){var C=D.x,A=D.y,z=this.getX(),B=this.getY();if(C!==undefined){z+=C}if(A!==undefined){B+=A}this.setPosition({x:z,y:B});return this},_eachAncestorReverse:function(A,B){var z=[],y=this.getParent(),x,C;if(B&&B._id===this._id){A(this);return true}z.unshift(this);while(y&&(!B||y._id!==B._id)){z.unshift(y);y=y.parent}x=z.length;for(C=0;C<x;C++){A(z[C])}},rotate:function(x){this.setRotation(this.getRotation()+x);return this},moveToTop:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.");return}var x=this.index;this.parent.children.splice(x,1);this.parent.children.push(this);this.parent._setChildrenIndices();return true},moveUp:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveUp function is ignored.");return}var y=this.index,x=this.parent.getChildren().length;if(y<x-1){this.parent.children.splice(y,1);this.parent.children.splice(y+1,0,this);this.parent._setChildrenIndices();return true}return false},moveDown:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveDown function is ignored.");return}var x=this.index;if(x>0){this.parent.children.splice(x,1);this.parent.children.splice(x-1,0,this);this.parent._setChildrenIndices();return true}return false},moveToBottom:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.");return}var x=this.index;if(x>0){this.parent.children.splice(x,1);this.parent.children.unshift(this);this.parent._setChildrenIndices();return true}return false},setZIndex:function(y){if(!this.parent){Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.");return}var x=this.index;this.parent.children.splice(x,1);this.parent.children.splice(y,0,this);this.parent._setChildrenIndices();return this},getAbsoluteOpacity:function(){return this._getCache(c,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var x=this.getOpacity();if(this.getParent()){x*=this.getParent().getAbsoluteOpacity()}return x},moveTo:function(x){Kinetic.Node.prototype.remove.call(this);x.add(this);return this},toObject:function(){var B=Kinetic.Util,C={},z=this.getAttrs(),A,D,x,y;C.attrs={};for(A in z){D=z[A];if(!B._isFunction(D)&&!B._isElement(D)&&!(B._isObject(D)&&B._hasMethods(D))){x=this[A];delete z[A];y=x?x.call(this):null;z[A]=D;if(y!==D){C.attrs[A]=D}}}C.className=this.getClassName();return C},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var x=this.getParent();return x?x.getLayer():null},getStage:function(){return this._getCache(h,this._getStage)},_getStage:function(){var x=this.getParent();if(x){return x.getStage()}else{return undefined}},fire:function(z,y,x){if(x){this._fireAndBubble(z,y||{})}else{this._fire(z,y||{})}return this},getAbsoluteTransform:function(x){if(x){return this._getAbsoluteTransform(x)}else{return this._getCache(n,this._getAbsoluteTransform)}},_getAbsoluteTransform:function(A){var x=new Kinetic.Transform(),z,y;this._eachAncestorReverse(function(B){z=B.transformsEnabled();y=B.getTransform();if(z==="all"){x.multiply(y)}else{if(z==="position"){x.translate(B.x(),B.y())}}},A);return x},getTransform:function(){return this._getCache(d,this._getTransform)},_getTransform:function(){var z=new Kinetic.Transform(),E=this.getX(),C=this.getY(),I=Kinetic.getAngle(this.getRotation()),H=this.getScaleX(),G=this.getScaleY(),F=this.getSkewX(),D=this.getSkewY(),B=this.getOffsetX(),A=this.getOffsetY();if(E!==0||C!==0){z.translate(E,C)}if(I!==0){z.rotate(I)}if(F!==0||D!==0){z.skew(F,D)}if(H!==1||G!==1){z.scale(H,G)}if(B!==0||A!==0){z.translate(-1*B,-1*A)}return z},clone:function(C){var E=this.getClassName(),H=Kinetic.Util.cloneObject(this.attrs),G,F,D,x,y;for(var B in p){var A=p[B];delete H[A]}for(G in C){H[G]=C[G]}var z=new Kinetic[E](H);for(G in this.eventListeners){F=this.eventListeners[G];D=F.length;for(x=0;x<D;x++){y=F[x];if(y.name.indexOf(s)<0){if(!z.eventListeners[G]){z.eventListeners[G]=[]}z.eventListeners[G].push(y)}}}return z},toDataURL:function(C){C=C||{};var E=C.mimeType||null,G=C.quality||null,B=this.getStage(),z=C.x||0,F=C.y||0,A=new Kinetic.SceneCanvas({width:C.width||this.getWidth()||(B?B.getWidth():0),height:C.height||this.getHeight()||(B?B.getHeight():0),pixelRatio:1}),D=A.getContext();D.save();if(z||F){D.translate(-1*z,-1*F)}this.drawScene(A);D.restore();return A.toDataURL(E,G)},toImage:function(x){Kinetic.Util._getImage(this.toDataURL(x),function(y){x.callback(y)})},setSize:function(x){this.setWidth(x.width);this.setHeight(x.height);return this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){if(this.attrs.dragDistance!==undefined){return this.attrs.dragDistance}else{if(this.parent){return this.parent.getDragDistance()}else{return Kinetic.dragDistance}}},_get:function(x){return this.nodeType===x?[this]:[]},_off:function(z,x){var A=this.eventListeners[z],y,B;for(y=0;y<A.length;y++){B=A[y].name;if((B!=="kinetic"||x==="kinetic")&&(!x||B===x)){A.splice(y,1);if(A.length===0){delete this.eventListeners[z];break}y--}}},_fireChangeEvent:function(x,y,z){this._fire(x+l,{oldVal:y,newVal:z})},setId:function(y){var x=this.getId();Kinetic._removeId(x);Kinetic._addId(this,y);this._setAttr(i,y);return this},setName:function(x){var y=this.getName();Kinetic._removeName(y,this._id);Kinetic._addName(this,x);this._setAttr(f,x);return this},setAttr:function(){var y=Array.prototype.slice.call(arguments),x=y[0],A=y[1],B=o+Kinetic.Util._capitalize(x),z=this[B];if(Kinetic.Util._isFunction(z)){z.call(this,A)}else{this._setAttr(x,A)}return this},_setAttr:function(y,z){var x;if(z!==undefined){x=this.attrs[y];this.attrs[y]=z;this._fireChangeEvent(y,x,z)}},_setComponentAttr:function(z,y,A){var x;if(A!==undefined){x=this.attrs[z];if(!x){this.attrs[z]=this.getAttr(z)}this.attrs[z][y]=A;this._fireChangeEvent(z,x,A)}},_fireAndBubble:function(y,x,A){var z=true;if(x&&this.nodeType===q){x.target=this}if(y===u&&A&&this._id===A._id){z=false}else{if(y===g&&A&&this._id===A._id){z=false}}if(z){this._fire(y,x);if(x&&!x.cancelBubble&&this.parent){if(A&&A.parent){this._fireAndBubble.call(this.parent,y,x,A.parent)}else{this._fireAndBubble.call(this.parent,y,x)}}}},_fire:function(A,x){var z=this.eventListeners[A],y;x.type=A;if(z){for(y=0;y<z.length;y++){z[y].handler.call(this,x)}}},draw:function(){this.drawScene();this.drawHit();return this}});Kinetic.Node.create=function(y,x){return this._createNode(JSON.parse(y),x)};Kinetic.Node._createNode=function(B,y){var A=Kinetic.Node.prototype.getClassName.call(B),z=B.children,C,x,D;if(y){B.attrs.container=y}C=new Kinetic[A](B.attrs);if(z){x=z.length;for(D=0;D<x;D++){C.add(this._createNode(z[D]))}}return C};Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position");Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1);Kinetic.Factory.addGetter(Kinetic.Node,"name");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name");Kinetic.Factory.addGetter(Kinetic.Node,"id");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id");Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0);Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance");Kinetic.Factory.addSetter(Kinetic.Node,"width",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width");Kinetic.Factory.addSetter(Kinetic.Node,"height",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height");Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",undefined,function(x){this._filterUpToDate=false;return x});Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size");Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});Kinetic.Collection.mapMethods(Kinetic.Node)})();(function(){Kinetic.Filters.Grayscale=function(e){var c=e.data,a=c.length,b,d;for(b=0;b<a;b+=4){d=0.34*c[b]+0.5*c[b+1]+0.16*c[b+2];c[b]=d;c[b+1]=d;c[b+2]=d}}})();(function(){Kinetic.Filters.Brighten=function(e){var d=this.brightness()*255,c=e.data,a=c.length,b;for(b=0;b<a;b+=4){c[b]+=d;c[b+1]+=d;c[b+2]+=d}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Invert=function(d){var c=d.data,a=c.length,b;for(b=0;b<a;b+=4){c[b]=255-c[b];c[b+1]=255-c[b+1];c[b+2]=255-c[b+2]}}})();(function(){function c(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function b(T,O){var l=T.data,e=T.width,g=T.height;var M,L,V,S,u,z,q,j,k,F,R,s,G,D,f,J,N,v,r,o,w,A,B,I;var W=O+O+1,t=e-1,Q=g-1,n=O+1,P=n*(n+1)/2,H=new c(),m=null,E=H,U=null,K=null,C=a[O],h=d[O];for(V=1;V<W;V++){E=E.next=new c();if(V==n){m=E}}E.next=H;q=z=0;for(L=0;L<g;L++){J=N=v=r=j=k=F=R=0;s=n*(o=l[z]);G=n*(w=l[z+1]);D=n*(A=l[z+2]);f=n*(B=l[z+3]);j+=P*o;k+=P*w;F+=P*A;R+=P*B;E=H;for(V=0;V<n;V++){E.r=o;E.g=w;E.b=A;E.a=B;E=E.next}for(V=1;V<n;V++){S=z+((t<V?t:V)<<2);j+=(E.r=(o=l[S]))*(I=n-V);k+=(E.g=(w=l[S+1]))*I;F+=(E.b=(A=l[S+2]))*I;R+=(E.a=(B=l[S+3]))*I;J+=o;N+=w;v+=A;r+=B;E=E.next}U=H;K=m;for(M=0;M<e;M++){l[z+3]=B=(R*C)>>h;if(B!==0){B=255/B;l[z]=((j*C)>>h)*B;l[z+1]=((k*C)>>h)*B;l[z+2]=((F*C)>>h)*B}else{l[z]=l[z+1]=l[z+2]=0}j-=s;k-=G;F-=D;R-=f;s-=U.r;G-=U.g;D-=U.b;f-=U.a;S=(q+((S=M+O+1)<t?S:t))<<2;J+=(U.r=l[S]);N+=(U.g=l[S+1]);v+=(U.b=l[S+2]);r+=(U.a=l[S+3]);j+=J;k+=N;F+=v;R+=r;U=U.next;s+=(o=K.r);G+=(w=K.g);D+=(A=K.b);f+=(B=K.a);J-=o;N-=w;v-=A;r-=B;K=K.next;z+=4}q+=e}for(M=0;M<e;M++){N=v=r=J=k=F=R=j=0;z=M<<2;s=n*(o=l[z]);G=n*(w=l[z+1]);D=n*(A=l[z+2]);f=n*(B=l[z+3]);j+=P*o;k+=P*w;F+=P*A;R+=P*B;E=H;for(V=0;V<n;V++){E.r=o;E.g=w;E.b=A;E.a=B;E=E.next}u=e;for(V=1;V<=O;V++){z=(u+M)<<2;j+=(E.r=(o=l[z]))*(I=n-V);k+=(E.g=(w=l[z+1]))*I;F+=(E.b=(A=l[z+2]))*I;R+=(E.a=(B=l[z+3]))*I;J+=o;N+=w;v+=A;r+=B;E=E.next;if(V<Q){u+=e}}z=M;U=H;K=m;for(L=0;L<g;L++){S=z<<2;l[S+3]=B=(R*C)>>h;if(B>0){B=255/B;l[S]=((j*C)>>h)*B;l[S+1]=((k*C)>>h)*B;l[S+2]=((F*C)>>h)*B}else{l[S]=l[S+1]=l[S+2]=0}j-=s;k-=G;F-=D;R-=f;s-=U.r;G-=U.g;D-=U.b;f-=U.a;S=(M+(((S=L+n)<Q?S:Q)*e))<<2;j+=(J+=(U.r=l[S]));k+=(N+=(U.g=l[S+1]));F+=(v+=(U.b=l[S+2]));R+=(r+=(U.a=l[S+3]));U=U.next;s+=(o=K.r);G+=(w=K.g);D+=(A=K.b);f+=(B=K.a);J-=o;N-=w;v-=A;r-=B;K=K.next;z+=e}}}Kinetic.Filters.Blur=function(f){var e=Math.round(this.blurRadius());if(e>0){b(f,e)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)})();(function(){function c(m,j,l){var i=(l*m.width+j)*4;var k=[];k.push(m.data[i++],m.data[i++],m.data[i++],m.data[i++]);return k}function h(j,i){return Math.sqrt(Math.pow(j[0]-i[0],2)+Math.pow(j[1]-i[1],2)+Math.pow(j[2]-i[2],2))}function e(l){var j=[0,0,0];for(var k=0;k<l.length;k++){j[0]+=l[k][0];j[1]+=l[k][1];j[2]+=l[k][2]}j[0]/=l.length;j[1]/=l.length;j[2]/=l.length;return j}function g(k,o){var q=c(k,0,0);var j=c(k,k.width-1,0);var r=c(k,0,k.height-1);var l=c(k,k.width-1,k.height-1);var n=o||10;if(h(q,j)<n&&h(j,l)<n&&h(l,r)<n&&h(r,q)<n){var t=e([j,q,l,r]);var s=[];for(var m=0;m<k.width*k.height;m++){var p=h(t,[k.data[m*4],k.data[m*4+1],k.data[m*4+2]]);s[m]=(p<n)?0:255}return s}}function b(l,j){for(var k=0;k<l.width*l.height;k++){l.data[4*k+3]=j[k]}}function d(A,z,p){var w=[1,1,1,1,0,1,1,1,1];var r=Math.round(Math.sqrt(w.length));var i=Math.floor(r/2);var o=[];for(var s=0;s<p;s++){for(var v=0;v<z;v++){var j=s*z+v;var u=0;for(var l=0;l<r;l++){for(var n=0;n<r;n++){var k=s+l-i;var m=v+n-i;if(k>=0&&k<p&&m>=0&&m<z){var t=k*z+m;var q=w[l*r+n];u+=A[t]*q}}}o[j]=(u===255*8)?255:0}}return o}function f(A,z,p){var w=[1,1,1,1,1,1,1,1,1];var r=Math.round(Math.sqrt(w.length));var i=Math.floor(r/2);var o=[];for(var s=0;s<p;s++){for(var v=0;v<z;v++){var j=s*z+v;var u=0;for(var l=0;l<r;l++){for(var n=0;n<r;n++){var k=s+l-i;var m=v+n-i;if(k>=0&&k<p&&m>=0&&m<z){var t=k*z+m;var q=w[l*r+n];u+=A[t]*q}}}o[j]=(u>=255*4)?255:0}}return o}function a(A,z,p){var w=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];var r=Math.round(Math.sqrt(w.length));var i=Math.floor(r/2);var o=[];for(var s=0;s<p;s++){for(var v=0;v<z;v++){var j=s*z+v;var u=0;for(var l=0;l<r;l++){for(var n=0;n<r;n++){var k=s+l-i;var m=v+n-i;if(k>=0&&k<p&&m>=0&&m<z){var t=k*z+m;var q=w[l*r+n];u+=A[t]*q}}}o[j]=u}}return o}Kinetic.Filters.Mask=function(k){var i=this.threshold(),j=g(k,i);if(j){j=d(j,k.width,k.height);j=f(j,k.width,k.height);j=a(j,k.width,k.height);b(k,j)}return k};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.RGB=function(h){var e=h.data,b=e.length,g=this.red(),d=this.green(),a=this.blue(),c,f;for(c=0;c<b;c+=4){f=(0.34*e[c]+0.5*e[c+1]+0.16*e[c+2])/255;e[c]=f*g;e[c+1]=f*d;e[c+2]=f*a;e[c+3]=e[c+3]}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(a){this._filterUpToDate=false;if(a>255){return 255}else{if(a<0){return 0}else{return Math.round(a)}}});Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(a){this._filterUpToDate=false;if(a>255){return 255}else{if(a<0){return 0}else{return Math.round(a)}}});Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.HSV=function(t){var D=t.data,B=D.length,f=Math.pow(2,this.value()),j=Math.pow(2,this.saturation()),p=Math.abs((this.hue())+360)%360,o;var A=f*j*Math.cos(p*Math.PI/180),w=f*j*Math.sin(p*Math.PI/180);var e=0.299*f+0.701*A+0.167*w,l=0.587*f-0.587*A+0.33*w,n=0.114*f-0.114*A-0.497*w;var m=0.299*f-0.299*A-0.328*w,u=0.587*f+0.413*A+0.035*w,C=0.114*f-0.114*A+0.293*w;var z=0.299*f-0.3*A+1.25*w,c=0.587*f-0.586*A-1.05*w,d=0.114*f+0.886*A-0.2*w;var k,q,x,y;for(o=0;o<B;o+=4){k=D[o+0];q=D[o+1];x=D[o+2];y=D[o+3];D[o+0]=e*k+l*q+n*x;D[o+1]=m*k+u*q+C*x;D[o+2]=z*k+c*q+d*x;D[o+3]=y}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Filters.HSL=function(w){var F=w.data,D=F.length,f=1,j=Math.pow(2,this.saturation()),t=Math.abs((this.hue())+360)%360,o=this.luminance()*127,q;var C=f*j*Math.cos(t*Math.PI/180),y=f*j*Math.sin(t*Math.PI/180);var e=0.299*f+0.701*C+0.167*y,m=0.587*f-0.587*C+0.33*y,p=0.114*f-0.114*C-0.497*y;var n=0.299*f-0.299*C-0.328*y,x=0.587*f+0.413*C+0.035*y,E=0.114*f-0.114*C+0.293*y;var B=0.299*f-0.3*C+1.25*y,c=0.587*f-0.586*C-1.05*y,d=0.114*f+0.886*C-0.2*y;var k,u,z,A;for(q=0;q<D;q+=4){k=F[q+0];u=F[q+1];z=F[q+2];A=F[q+3];F[q+0]=e*k+m*u+p*z+o;F[q+1]=n*k+x*u+E*z+o;F[q+2]=B*k+c*u+d*z+o;F[q+3]=A}}})();(function(){Kinetic.Filters.Emboss=function(B){var I=this.embossStrength()*10,t=this.embossWhiteLevel()*255,G=this.embossDirection(),v=this.embossBlend(),E=0,H=0,J=B.data,m=B.width,z=B.height,j=m*4,k=z;switch(G){case"top-left":E=-1;H=-1;break;case"top":E=-1;H=0;break;case"top-right":E=-1;H=1;break;case"right":E=0;H=1;break;case"bottom-right":E=1;H=1;break;case"bottom":E=1;H=0;break;case"bottom-left":E=1;H=-1;break;case"left":E=0;H=-1;break}do{var C=(k-1)*j;var n=E;if(k+n<1){n=0}if(k+n>z){n=0}var K=(k-1+n)*m*4;var l=m;do{var d=C+(l-1)*4;var o=H;if(l+o<1){o=0}if(l+o>m){o=0}var c=K+(l-1+o)*4;var f=J[d]-J[c];var p=J[d+1]-J[c+1];var u=J[d+2]-J[c+2];var D=f;var s=D>0?D:-D;var e=p>0?p:-p;var i=u>0?u:-u;if(e>s){D=p}if(i>s){D=u}D*=I;if(v){var q=J[d]+D;var A=J[d+1]+D;var F=J[d+2]+D;J[d]=(q>255)?255:(q<0?0:q);J[d+1]=(A>255)?255:(A<0?0:A);J[d+2]=(F>255)?255:(F<0?0:F)}else{var a=t-D;if(a<0){a=0}else{if(a>255){a=255}}J[d]=J[d+1]=J[d+2]=a}}while(--l)}while(--k)};Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",0.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",0.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",false,null,Kinetic.Factory.afterSetFilter)})();(function(){function a(i,h,e,b,g){var d=e-h,f=g-b,c;if(d===0){return b+f/2}if(f===0){return b}c=(i-h)/d;c=(f*c)+b;return c}Kinetic.Filters.Enhance=function(z){var G=z.data,d=G.length,F=G[0],c=F,s,f=G[1],k=f,y,t=G[2],v=t,C,l=G[3],o=l,w;var q=this.enhance();if(q===0){return}for(w=0;w<d;w+=4){s=G[w+0];if(s<F){F=s}else{if(s>c){c=s}}y=G[w+1];if(y<f){f=y}else{if(y>k){k=y}}C=G[w+2];if(C<t){t=C}else{if(C>v){v=C}}}if(c===F){c=255;F=0}if(k===f){k=255;f=0}if(v===t){v=255;t=0}if(o===l){o=255;l=0}var e,D,A,p,n,j,x,m,B,u,E,h;if(q>0){D=c+q*(255-c);A=F-q*(F-0);n=k+q*(255-k);j=f-q*(f-0);m=v+q*(255-v);h=t-q*(t-0);E=o+q*(255-o);B=l-q*(l-0)}else{e=(c+F)*0.5;D=c+q*(c-e);A=F+q*(F-e);p=(k+f)*0.5;n=k+q*(k-p);j=f+q*(f-p);x=(v+t)*0.5;m=v+q*(v-x);h=t+q*(t-x);u=(o+l)*0.5;E=o+q*(o-u);B=l+q*(l-u)}for(w=0;w<d;w+=4){G[w+0]=a(G[w+0],F,c,A,D);G[w+1]=a(G[w+1],f,k,j,n);G[w+2]=a(G[w+2],t,v,h,m)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Posterize=function(f){var d=Math.round(this.levels()*254)+1,c=f.data,a=c.length,e=(255/d),b;for(b=0;b<a;b+=1){c[b]=Math.floor(c[b]/e)*e}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",0.5,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Noise=function(f){var c=this.noise()*255,e=f.data,a=e.length,d=c/2,b;for(b=0;b<a;b+=4){e[b+0]+=d-2*d*Math.random();e[b+1]+=d-2*d*Math.random();e[b+2]+=d-2*d*Math.random()}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",0.2,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Pixelate=function(p){var r=Math.ceil(this.pixelSize()),m=p.width,l=p.height,h,g,n,e,j,a,b,u=Math.ceil(m/r),t=Math.ceil(l/r),q,d,f,c,o,s,k;p=p.data;for(o=0;o<u;o+=1){for(s=0;s<t;s+=1){e=0;j=0;a=0;b=0;q=o*r;d=q+r;f=s*r;c=f+r;k=0;for(h=q;h<d;h+=1){if(h>=m){continue}for(g=f;g<c;g+=1){if(g>=l){continue}n=(m*g+h)*4;e+=p[n+0];j+=p[n+1];a+=p[n+2];b+=p[n+3];k+=1}}e=e/k;j=j/k;a=a/k;for(h=q;h<d;h+=1){if(h>=m){continue}for(g=f;g<c;g+=1){if(g>=l){continue}n=(m*g+h)*4;p[n+0]=e;p[n+1]=j;p[n+2]=a;p[n+3]=b}}}}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Threshold=function(e){var d=this.threshold()*255,c=e.data,a=c.length,b;for(b=0;b<a;b+=1){c[b]=c[b]<d?0:255}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0.5,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Sepia=function(c){var j=c.data,o=c.width,m=c.height,e=o*4,i,n,f,h,p,d,a,k,l;do{i=(m-1)*e;n=o;do{f=i+(n-1)*4;h=j[f];p=j[f+1];d=j[f+2];a=h*0.393+p*0.769+d*0.189;k=h*0.349+p*0.686+d*0.168;l=h*0.272+p*0.534+d*0.131;j[f]=a>255?255:a;j[f+1]=k>255?255:k;j[f+2]=l>255?255:l;j[f+3]=j[f+3]}while(--n)}while(--m)}})();(function(){Kinetic.Filters.Solarize=function(c){var i=c.data,o=c.width,j=c.height,d=o*4,m=j;do{var f=(m-1)*d;var n=o;do{var e=f+(n-1)*4;var a=i[e];var k=i[e+1];var l=i[e+2];if(a>127){a=255-a}if(k>127){k=255-k}if(l>127){l=255-l}i[e]=a;i[e+1]=k;i[e+2]=l}while(--n)}while(--m)}})();(function(){var a=function(n,G,f){var C=n.data,u=G.data,B=n.width,t=n.height,h=f.polarCenterX||B/2,m=f.polarCenterY||t/2,z,s,q,w=0,A=0,D=0,E=0;var F,e=Math.sqrt(h*h+m*m);s=B-h;q=t-m;F=Math.sqrt(s*s+q*q);e=(F>e)?F:e;var k=t,p=B,l,o;var v=360/p*Math.PI/180,d,j;for(o=0;o<p;o+=1){d=Math.sin(o*v);j=Math.cos(o*v);for(l=0;l<k;l+=1){s=Math.floor(h+e*l/k*j);q=Math.floor(m+e*l/k*d);z=(q*B+s)*4;w=C[z+0];A=C[z+1];D=C[z+2];E=C[z+3];z=(o+l*B)*4;u[z+0]=w;u[z+1]=A;u[z+2]=D;u[z+3]=E}}};var c=function(m,I,e){var E=m.data,v=I.data,D=m.width,u=m.height,f=e.polarCenterX||D/2,l=e.polarCenterY||u/2,A,q,p,t,s,w=0,C=0,F=0,G=0;var H,d=Math.sqrt(f*f+l*l);q=D-f;p=u-l;H=Math.sqrt(q*q+p*p);d=(H>d)?H:d;var j=u,o=D,k,n,z=e.polarRotation||0;var B,h;for(q=0;q<D;q+=1){for(p=0;p<u;p+=1){t=q-f;s=p-l;k=Math.sqrt(t*t+s*s)*j/d;n=(Math.atan2(s,t)*180/Math.PI+360+z)%360;n=n*o/360;B=Math.floor(n);h=Math.floor(k);A=(h*D+B)*4;w=E[A+0];C=E[A+1];F=E[A+2];G=E[A+3];A=(p*D+q)*4;v[A+0]=w;v[A+1]=C;v[A+2]=F;v[A+3]=G}}};var b=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(u){var z=u.width,o=u.height;var n,l,v,q,p,s,B,D,t,d;var m=Math.round(this.kaleidoscopePower());var w=Math.round(this.kaleidoscopeAngle());var f=Math.floor(z*(w%360)/360);if(m<1){return}b.width=z;b.height=o;var j=b.getContext("2d").getImageData(0,0,z,o);a(u,j,{polarCenterX:z/2,polarCenterY:o/2});var h=z/Math.pow(2,m);while(h<=8){h=h*2;m-=1}h=Math.ceil(h);var A=h;var e=0,k=A,C=1;if(f+h>z){e=A;k=0;C=-1}for(l=0;l<o;l+=1){for(n=e;n!==k;n+=C){v=Math.round(n+f)%z;t=(z*l+v)*4;p=j.data[t+0];s=j.data[t+1];B=j.data[t+2];D=j.data[t+3];d=(z*l+n)*4;j.data[d+0]=p;j.data[d+1]=s;j.data[d+2]=B;j.data[d+3]=D}}for(l=0;l<o;l+=1){A=Math.floor(h);for(q=0;q<m;q+=1){for(n=0;n<A+1;n+=1){t=(z*l+n)*4;p=j.data[t+0];s=j.data[t+1];B=j.data[t+2];D=j.data[t+3];d=(z*l+A*2-n-1)*4;j.data[d+0]=p;j.data[d+1]=s;j.data[d+2]=B;j.data[d+3]=D}A*=2}}c(j,u,{polarRotation:0})};Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)})();(function(){var c=500;var b=(function(){if(Kinetic.root.performance&&Kinetic.root.performance.now){return function(){return Kinetic.root.performance.now()}}else{return function(){return new Date().getTime()}}})();var f=(function(){return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||e})();function e(g){Kinetic.root.setTimeout(g,1000/60)}function d(){return f.apply(Kinetic.root,arguments)}Kinetic.Animation=function(h,i){var g=Kinetic.Animation;this.func=h;this.setLayers(i);this.id=g.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:b()}};Kinetic.Animation.prototype={setLayers:function(h){var g=[];if(!h){g=[]}else{if(h.length>0){g=h}else{g=[h]}}this.layers=g},getLayers:function(){return this.layers},addLayer:function(h){var i=this.layers,g,j;if(i){g=i.length;for(j=0;j<g;j++){if(i[j]._id===h._id){return false}}}else{this.layers=[]}this.layers.push(h);return true},isRunning:function(){var h=Kinetic.Animation,j=h.animations,g=j.length,i;for(i=0;i<g;i++){if(j[i].id===this.id){return true}}return false},start:function(){var g=Kinetic.Animation;this.stop();this.frame.timeDiff=0;this.frame.lastTime=b();g._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(g){this.frame.timeDiff=g-this.frame.lastTime;this.frame.lastTime=g;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1000/this.frame.timeDiff}};Kinetic.Animation.animations=[];Kinetic.Animation.animIdCounter=0;Kinetic.Animation.animRunning=false;Kinetic.Animation._addAnimation=function(g){this.animations.push(g);this._handleAnimation()};Kinetic.Animation._removeAnimation=function(h){var k=h.id,j=this.animations,g=j.length,i;for(i=0;i<g;i++){if(j[i].id===k){this.animations.splice(i,1);break}}};Kinetic.Animation._runFrames=function(){var q={},r=this.animations,j,k,h,g,l,o,m,p;for(g=0;g<r.length;g++){j=r[g];k=j.layers;h=j.func;j._updateFrameObject(b());o=k.length;for(l=0;l<o;l++){m=k[l];if(m._id!==undefined){q[m._id]=m}}if(h){h.call(j,j.frame)}}for(p in q){q[p].draw()}};Kinetic.Animation._animationLoop=function(){var g=Kinetic.Animation;if(g.animations.length){d(g._animationLoop);g._runFrames()}else{g.animRunning=false}};Kinetic.Animation._handleAnimation=function(){var g=this;if(!this.animRunning){this.animRunning=true;g._animationLoop()}};var a=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(g){a.call(this,g)};Kinetic.Layer.prototype.batchDraw=function(){var h=this,g=Kinetic.Animation;if(!this.batchAnim){this.batchAnim=new g(function(){if(h.lastBatchDrawTime&&b()-h.lastBatchDrawTime>c){h.batchAnim.stop()}},this)}this.lastBatchDrawTime=b();if(!this.batchAnim.isRunning()){this.draw();this.batchAnim.start()}};Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(g){g.batchDraw()})}})((1,eval)("this"));(function(){var d={node:1,duration:1,easing:1,onFinish:1,yoyo:1},c=1,b=2,e=3,a=0;Kinetic.Tween=function(g){var k=this,j=g.node,m=j._id,l=g.duration||1,n=g.easing||Kinetic.Easings.Linear,i=!!g.yoyo,h;this.node=j;this._id=a++;this.anim=new Kinetic.Animation(function(){k.tween.onEnterFrame()},j.getLayer());this.tween=new f(h,function(o){k._tweenFunc(o)},n,0,1,l*1000,i);this._addListeners();if(!Kinetic.Tween.attrs[m]){Kinetic.Tween.attrs[m]={}}if(!Kinetic.Tween.attrs[m][this._id]){Kinetic.Tween.attrs[m][this._id]={}}if(!Kinetic.Tween.tweens[m]){Kinetic.Tween.tweens[m]={}}for(h in g){if(d[h]===undefined){this._addAttr(h,g[h])}}this.reset();this.onFinish=g.onFinish;this.onReset=g.onReset};Kinetic.Tween.attrs={};Kinetic.Tween.tweens={};Kinetic.Tween.prototype={_addAttr:function(p,k){var j=this.node,i=j._id,g,o,l,h,m;l=Kinetic.Tween.tweens[i][p];if(l){delete Kinetic.Tween.attrs[i][l][p]}g=j.getAttr(p);if(Kinetic.Util._isArray(k)){o=[];m=k.length;for(h=0;h<m;h++){o.push(k[h]-g[h])}}else{o=k-g}Kinetic.Tween.attrs[i][this._id][p]={start:g,diff:o};Kinetic.Tween.tweens[i][p]=this._id},_tweenFunc:function(l){var k=this.node,r=Kinetic.Tween.attrs[k._id][this._id],q,o,g,p,h,j,m;for(q in r){o=r[q];g=o.start;p=o.diff;if(Kinetic.Util._isArray(g)){h=[];m=g.length;for(j=0;j<m;j++){h.push(g[j]+(p[j]*l))}}else{h=g+(p*l)}k.setAttr(q,h)}},_addListeners:function(){var g=this;this.tween.onPlay=function(){g.anim.start()};this.tween.onReverse=function(){g.anim.start()};this.tween.onPause=function(){g.anim.stop()};this.tween.onFinish=function(){if(g.onFinish){g.onFinish()}};this.tween.onReset=function(){if(g.onReset){g.onReset()}}},play:function(){this.tween.play();return this},reverse:function(){this.tween.reverse();return this},reset:function(){var g=this.node;this.tween.reset();return this},seek:function(g){var h=this.node;this.tween.seek(g*1000);return this},pause:function(){this.tween.pause();return this},finish:function(){var g=this.node;this.tween.finish();return this},destroy:function(){var j=this.node._id,g=this._id,h=Kinetic.Tween.tweens[j],i;this.pause();for(i in h){delete Kinetic.Tween.tweens[j][i]}delete Kinetic.Tween.attrs[j][g]}};var f=function(m,l,j,i,g,k,h){this.prop=m;this.propFunc=l;this.begin=i;this._pos=i;this.duration=k;this._change=0;this.prevPos=0;this.yoyo=h;this._time=0;this._position=0;this._startTime=0;this._finish=0;this.func=j;this._change=g-this.begin;this.pause()};f.prototype={fire:function(h){var g=this[h];if(g){g()}},setTime:function(g){if(g>this.duration){if(this.yoyo){this._time=this.duration;this.reverse()}else{this.finish()}}else{if(g<0){if(this.yoyo){this._time=0;this.play()}else{this.reset()}}else{this._time=g;this.update()}}},getTime:function(){return this._time},setPosition:function(g){this.prevPos=this._pos;this.propFunc(g);this._pos=g},getPosition:function(g){if(g===undefined){g=this._time}return this.func(g,this.begin,this._change,this.duration)},play:function(){this.state=b;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")},reverse:function(){this.state=e;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")},seek:function(g){this.pause();this._time=g;this.update();this.fire("onSeek")},reset:function(){this.pause();this._time=0;this.update();this.fire("onReset")},finish:function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var g=this.getTimer()-this._startTime;if(this.state===b){this.setTime(g)}else{if(this.state===e){this.setTime(this.duration-g)}}},pause:function(){this.state=c;this.fire("onPause")},getTimer:function(){return new Date().getTime()}};Kinetic.Easings={BackEaseIn:function(h,g,k,j){var i=1.70158;return k*(h/=j)*h*((i+1)*h-i)+g},BackEaseOut:function(h,g,k,j){var i=1.70158;return k*((h=h/j-1)*h*((i+1)*h+i)+1)+g},BackEaseInOut:function(h,g,k,j){var i=1.70158;if((h/=j/2)<1){return k/2*(h*h*(((i*=(1.525))+1)*h-i))+g}return k/2*((h-=2)*h*(((i*=(1.525))+1)*h+i)+2)+g},ElasticEaseIn:function(i,g,m,l,h,k){var j=0;if(i===0){return g}if((i/=l)==1){return g+m}if(!k){k=l*0.3}if(!h||h<Math.abs(m)){h=m;j=k/4}else{j=k/(2*Math.PI)*Math.asin(m/h)}return -(h*Math.pow(2,10*(i-=1))*Math.sin((i*l-j)*(2*Math.PI)/k))+g},ElasticEaseOut:function(i,g,m,l,h,k){var j=0;if(i===0){return g}if((i/=l)==1){return g+m}if(!k){k=l*0.3}if(!h||h<Math.abs(m)){h=m;j=k/4}else{j=k/(2*Math.PI)*Math.asin(m/h)}return(h*Math.pow(2,-10*i)*Math.sin((i*l-j)*(2*Math.PI)/k)+m+g)},ElasticEaseInOut:function(i,g,m,l,h,k){var j=0;if(i===0){return g}if((i/=l/2)==2){return g+m}if(!k){k=l*(0.3*1.5)}if(!h||h<Math.abs(m)){h=m;j=k/4}else{j=k/(2*Math.PI)*Math.asin(m/h)}if(i<1){return -0.5*(h*Math.pow(2,10*(i-=1))*Math.sin((i*l-j)*(2*Math.PI)/k))+g}return h*Math.pow(2,-10*(i-=1))*Math.sin((i*l-j)*(2*Math.PI)/k)*0.5+m+g},BounceEaseOut:function(h,g,j,i){if((h/=i)<(1/2.75)){return j*(7.5625*h*h)+g}else{if(h<(2/2.75)){return j*(7.5625*(h-=(1.5/2.75))*h+0.75)+g}else{if(h<(2.5/2.75)){return j*(7.5625*(h-=(2.25/2.75))*h+0.9375)+g}else{return j*(7.5625*(h-=(2.625/2.75))*h+0.984375)+g}}}},BounceEaseIn:function(h,g,j,i){return j-Kinetic.Easings.BounceEaseOut(i-h,0,j,i)+g},BounceEaseInOut:function(h,g,j,i){if(h<i/2){return Kinetic.Easings.BounceEaseIn(h*2,0,j,i)*0.5+g}else{return Kinetic.Easings.BounceEaseOut(h*2-i,0,j,i)*0.5+j*0.5+g}},EaseIn:function(h,g,j,i){return j*(h/=i)*h+g},EaseOut:function(h,g,j,i){return -j*(h/=i)*(h-2)+g},EaseInOut:function(h,g,j,i){if((h/=i/2)<1){return j/2*h*h+g}return -j/2*((--h)*(h-2)-1)+g},StrongEaseIn:function(h,g,j,i){return j*(h/=i)*h*h*h*h+g},StrongEaseOut:function(h,g,j,i){return j*((h=h/i-1)*h*h*h*h+1)+g},StrongEaseInOut:function(h,g,j,i){if((h/=i/2)<1){return j/2*h*h*h*h*h+g}return j/2*((h-=2)*h*h*h*h+2)+g},Linear:function(h,g,j,i){return j*h/i+g}}})();(function(){Kinetic.DD={anim:new Kinetic.Animation(),isDragging:false,offset:{x:0,y:0},node:null,_drag:function(d){var c=Kinetic.DD,e=c.node;if(e){if(!c.isDragging){var h=e.getStage().getPointerPosition();var f=e.dragDistance();var g=Math.max(Math.abs(h.x-c.startPointerPos.x),Math.abs(h.y-c.startPointerPos.y));if(g<f){return}}e._setDragPosition(d);if(!c.isDragging){c.isDragging=true;e.fire("dragstart",{type:"dragstart",target:e,evt:d},true)}e.fire("dragmove",{type:"dragmove",target:e,evt:d},true)}},_endDragBefore:function(e){var c=Kinetic.DD,g=c.node,d,f;if(g){d=g.nodeType;f=g.getLayer();c.anim.stop();if(c.isDragging){c.isDragging=false;Kinetic.listenClickTap=false;if(e){e.dragEndNode=g}}delete c.node;(f||g).draw()}},_endDragAfter:function(c){c=c||{};var d=c.dragEndNode;if(c&&d){d.fire("dragend",{type:"dragend",target:d,evt:c},true)}}};Kinetic.Node.prototype.startDrag=function(){var c=Kinetic.DD,d=this.getStage(),f=this.getLayer(),g=d.getPointerPosition(),e=this.getAbsolutePosition();if(g){if(c.node){c.node.stopDrag()}c.node=this;c.startPointerPos=g;c.offset.x=g.x-e.x;c.offset.y=g.y-e.y;c.anim.setLayers(f||this.getLayers());c.anim.start();this._setDragPosition()}};Kinetic.Node.prototype._setDragPosition=function(e){var c=Kinetic.DD,g=this.getStage().getPointerPosition(),d=this.getDragBoundFunc();if(!g){return}var f={x:g.x-c.offset.x,y:g.y-c.offset.y};if(d!==undefined){f=d.call(this,f,e)}this.setAbsolutePosition(f)};Kinetic.Node.prototype.stopDrag=function(){var c=Kinetic.DD,d={};c._endDragBefore(d);c._endDragAfter(d)};Kinetic.Node.prototype.setDraggable=function(c){this._setAttr("draggable",c);this._dragChange()};var a=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var c=Kinetic.DD;if(c.node&&c.node._id===this._id){this.stopDrag()}a.call(this)};Kinetic.Node.prototype.isDragging=function(){var c=Kinetic.DD;return c.node&&c.node._id===this._id&&c.isDragging};Kinetic.Node.prototype._listenDrag=function(){var c=this;this._dragCleanup();if(this.getClassName()==="Stage"){this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(d){if(!Kinetic.DD.node){c.startDrag(d)}})}else{this.on("mousedown.kinetic touchstart.kinetic",function(d){if(!Kinetic.DD.node){c.startDrag(d)}})}};Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable){this._listenDrag()}else{this._dragCleanup();var d=this.getStage();var c=Kinetic.DD;if(d&&c.node&&c.node._id===this._id){c.node.stopDrag()}}};Kinetic.Node.prototype._dragCleanup=function(){if(this.getClassName()==="Stage"){this.off("contentMousedown.kinetic");this.off("contentTouchstart.kinetic")}else{this.off("mousedown.kinetic");this.off("touchstart.kinetic")}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc");Kinetic.Factory.addGetter(Kinetic.Node,"draggable",false);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var b=Kinetic.document.documentElement;b.addEventListener("mouseup",Kinetic.DD._endDragBefore,true);b.addEventListener("touchend",Kinetic.DD._endDragBefore,true);b.addEventListener("mouseup",Kinetic.DD._endDragAfter,false);b.addEventListener("touchend",Kinetic.DD._endDragAfter,false)})();(function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(a){this.children=new Kinetic.Collection();Kinetic.Node.call(this,a)},getChildren:function(a){if(!a){return this.children}else{var b=new Kinetic.Collection();this.children.each(function(c){if(a(c)){b.push(c)}});return b}},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){var b=Kinetic.Collection.toCollection(this.children);var c;for(var a=0;a<b.length;a++){c=b[a];delete c.parent;c.index=0;if(c.hasChildren()){c.removeChildren()}c.remove()}b=null;this.children=new Kinetic.Collection();return this},destroyChildren:function(){var b=Kinetic.Collection.toCollection(this.children);var c;for(var a=0;a<b.length;a++){c=b[a];delete c.parent;c.index=0;c.destroy()}b=null;this.children=new Kinetic.Collection();return this},add:function(c){if(arguments.length>1){for(var b=0;b<arguments.length;b++){this.add(arguments[b])}return}if(c.getParent()){c.moveTo(this);return}var a=this.children;this._validateAdd(c);c.index=a.length;c.parent=this;a.push(c);this._fire("add",{child:c});return this},destroy:function(){if(this.hasChildren()){this.destroyChildren()}Kinetic.Node.prototype.destroy.call(this)},find:function(e){var f=[],j=e.replace(/ /g,"").split(","),k=j.length,c,g,b,h,d,a,l;for(c=0;c<k;c++){b=j[c];if(b.charAt(0)==="#"){d=this._getNodeById(b.slice(1));if(d){f.push(d)}}else{if(b.charAt(0)==="."){h=this._getNodesByName(b.slice(1));f=f.concat(h)}else{a=this.getChildren();l=a.length;for(g=0;g<l;g++){f=f.concat(a[g]._get(b))}}}}return Kinetic.Collection.toCollection(f)},_getNodeById:function(a){var b=Kinetic.ids[a];if(b!==undefined&&this.isAncestorOf(b)){return b}return null},_getNodesByName:function(b){var a=Kinetic.names[b]||[];return this._getDescendants(a)},_get:function(b){var e=Kinetic.Node.prototype._get.call(this,b);var c=this.getChildren();var a=c.length;for(var d=0;d<a;d++){e=e.concat(c[d]._get(b))}return e},toObject:function(){var c=Kinetic.Node.prototype.toObject.call(this);c.children=[];var b=this.getChildren();var a=b.length;for(var e=0;e<a;e++){var d=b[e];c.children.push(d.toObject())}return c},_getDescendants:function(b){var e=[];var a=b.length;for(var d=0;d<a;d++){var c=b[d];if(this.isAncestorOf(c)){e.push(c)}}return e},isAncestorOf:function(b){var a=b.getParent();while(a){if(a._id===this._id){return true}a=a.getParent()}return false},clone:function(b){var a=Kinetic.Node.prototype.clone.call(this,b);this.getChildren().each(function(c){a.add(c.clone())});return a},getAllIntersections:function(b){var a=[];this.find("Shape").each(function(c){if(c.isVisible()&&c.intersects(b)){a.push(c)}});return a},_setChildrenIndices:function(){this.children.each(function(b,a){b.index=a})},drawScene:function(e,g){var d=this.getLayer(),b=e||(d&&d.getCanvas()),c=b&&b.getContext(),f=this._cache.canvas,a=f&&f.scene;if(this.isVisible()){if(a){this._drawCachedSceneCanvas(c)}else{this._drawChildren(b,"drawScene",g)}}return this},drawHit:function(d,f){var c=this.getLayer(),a=d||(c&&c.hitCanvas),b=a&&a.getContext(),e=this._cache.canvas,g=e&&e.hit;if(this.shouldDrawHit()){if(g){this._drawCachedHitCanvas(b)}else{this._drawChildren(a,"drawHit",f)}}return this},_drawChildren:function(b,g,h){var f=this.getLayer(),a=b&&b.getContext(),i=this.getClipWidth(),e=this.getClipHeight(),j=i&&e,d,c;if(j&&f){d=this.getClipX();c=this.getClipY();a.save();f._applyTransform(this,a);a.beginPath();a.rect(d,c,i,e);a.clip();a.reset()}this.children.each(function(k){k[g](b,h)});if(j){a.restore()}}});Kinetic.Util.extend(Kinetic.Container,Kinetic.Node);Kinetic.Container.prototype.get=Kinetic.Container.prototype.find;Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight");Kinetic.Collection.mapMethods(Kinetic.Container)})();(function(){var d="hasShadow";function b(g){g.fill()}function c(g){g.stroke()}function f(g){g.fill()}function a(g){g.stroke()}function e(){this._clearCache(d)}Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(h){this.nodeType="Shape";this._fillFunc=b;this._strokeFunc=c;this._fillFuncHit=f;this._strokeFuncHit=a;var g=Kinetic.shapes;var i;while(true){i=Kinetic.Util.getRandomColor();if(i&&!(i in g)){break}}this.colorKey=i;g[i]=this;Kinetic.Node.call(this,h);this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",e)},hasChildren:function(){return false},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(d,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&(this.getShadowOpacity()!==0&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY()))},hasFill:function(){return !!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return !!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(g){return this.className===g||this.nodeType===g?[this]:[]},intersects:function(j){var h=this.getStage(),g=h.bufferHitCanvas,i;g.getContext().clear();this.drawScene(g);i=g.context.getImageData(Math.round(j.x),Math.round(j.y),1,1).data;return i[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this);delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(q,n){var l=this.getLayer(),j=q||l.getCanvas(),i=j.getContext(),k=this._cache.canvas,o=this.sceneFunc(),p=this.hasShadow(),m,h,g;if(this.isVisible()){if(k){this._drawCachedSceneCanvas(i)}else{if(o){i.save();if(this._useBufferCanvas()){m=this.getStage();h=m.bufferCanvas;g=h.getContext();g.clear();g.save();g._applyLineJoin(this);l._applyTransform(this,g,n);o.call(this,g);g.restore();if(p){i.save();i._applyShadow(this);i.drawImage(h._canvas,0,0);i.restore()}i._applyOpacity(this);i.drawImage(h._canvas,0,0)}else{i._applyLineJoin(this);l._applyTransform(this,i,n);if(p){i.save();i._applyShadow(this);o.call(this,i);i.restore()}i._applyOpacity(this);o.call(this,i)}i.restore()}}}return this},drawHit:function(k,m){var j=this.getLayer(),g=k||j.hitCanvas,i=g.getContext(),h=this.hitFunc()||this.sceneFunc(),l=this._cache.canvas,n=l&&l.hit;if(this.shouldDrawHit()){if(n){this._drawCachedHitCanvas(i)}else{if(h){i.save();i._applyLineJoin(this);j._applyTransform(this,i,m);h.call(this,i);i.restore()}}}return this},drawHitFromCache:function(g){var k=g||0,m=this._cache.canvas,s=this._getCachedSceneCanvas(),t=s.getContext(),h=m.hit,j=h.getContext(),u=s.getWidth(),r=s.getHeight(),q,v,o,p,x,n,w,l;j.clear();try{q=t.getImageData(0,0,u,r);v=q.data;o=j.getImageData(0,0,u,r);p=o.data;x=v.length;n=Kinetic.Util._hexToRgb(this.colorKey);for(w=0;w<x;w+=4){l=v[w+3];if(l>k){p[w]=n.r;p[w+1]=n.g;p[w+2]=n.b;p[w+3]=255}}j.putImageData(o,0,0)}catch(y){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+y.message)}return this}});Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",true);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0);Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});Kinetic.Collection.mapMethods(Kinetic.Shape)})();(function(){var u="Stage",M="string",P="px",O="mouseout",s="mouseleave",m="mouseover",h="mouseenter",J="mousemove",E="mousedown",i="mouseup",I="click",g="dblclick",B="touchstart",D="touchend",k="tap",A="dbltap",F="touchmove",y="contentMouseout",c="contentMouseleave",H="contentMouseover",K="contentMouseenter",t="contentMousemove",l="contentMousedown",q="contentMouseup",x="contentClick",z="contentDblclick",v="contentTouchstart",r="contentTouchend",f="contentTap",G="contentDbltap",n="contentTouchmove",w="div",p="relative",N="inline-block",C="kineticjs-content",a=" ",L="_",d="container",o="",e=[E,J,i,O,B,F,D,m],b=e.length;function j(Q,R){Q.content.addEventListener(R,function(S){Q[L+R](S)},false)}Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(Q){this.nodeType=u;Kinetic.Container.call(this,Q);this._id=Kinetic.idCounter++;this._buildDOM();this._bindContentEvents();this._enableNestedTransforms=false;Kinetic.stages.push(this)},_validateAdd:function(Q){if(Q.getType()!=="Layer"){Kinetic.Util.error("You may only add layers to the stage.")}},setContainer:function(Q){if(typeof Q===M){var R=Q;Q=Kinetic.document.getElementById(Q);if(!Q){throw"Can not find container in document with id "+R}}this._setAttr(d,Q);return this},shouldDrawHit:function(){return true},draw:function(){Kinetic.Node.prototype.draw.call(this);return this},setHeight:function(Q){Kinetic.Node.prototype.setHeight.call(this,Q);this._resizeDOM();return this},setWidth:function(Q){Kinetic.Node.prototype.setWidth.call(this,Q);this._resizeDOM();return this},clear:function(){var R=this.children,Q=R.length,S;for(S=0;S<Q;S++){R[S].clear()}return this},clone:function(Q){if(!Q){Q={}}Q.container=Kinetic.document.createElement(w);return Kinetic.Container.prototype.clone.call(this,Q)},destroy:function(){var R=this.content;Kinetic.Container.prototype.destroy.call(this);if(R&&Kinetic.Util._isInDocument(R)){this.getContainer().removeChild(R)}var Q=Kinetic.stages.indexOf(this);if(Q>-1){Kinetic.stages.splice(Q,1)}},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(T){T=T||{};var R=T.mimeType||null,Y=T.quality||null,X=T.x||0,W=T.y||0,S=new Kinetic.SceneCanvas({width:T.width||this.getWidth(),height:T.height||this.getHeight(),pixelRatio:1}),Q=S.getContext()._context,V=this.children;if(X||W){Q.translate(-1*X,-1*W)}function U(ac){var aa=V[ac],Z=aa.toDataURL(),ab=new Kinetic.window.Image();ab.onload=function(){Q.drawImage(ab,0,0);if(ac<V.length-1){U(ac+1)}else{T.callback(S.toDataURL(R,Y))}};ab.src=Z}U(0)},toImage:function(R){var Q=R.callback;R.callback=function(S){Kinetic.Util._getImage(S,function(T){Q(T)})};this.toDataURL(R)},getIntersection:function(V){var T=this.getChildren(),Q=T.length,R=Q-1,U,S;for(U=R;U>=0;U--){S=T[U].getIntersection(V);if(S){return S}}return null},_resizeDOM:function(){if(this.content){var T=this.getWidth(),R=this.getHeight(),U=this.getChildren(),Q=U.length,V,S;this.content.style.width=T+P;this.content.style.height=R+P;this.bufferCanvas.setSize(T,R);this.bufferHitCanvas.setSize(T,R);for(V=0;V<Q;V++){S=U[V];S.getCanvas().setSize(T,R);S.hitCanvas.setSize(T,R);S.draw()}}},add:function(R){if(arguments.length>1){for(var Q=0;Q<arguments.length;Q++){this.add(arguments[Q])}return}Kinetic.Container.prototype.add.call(this,R);R._setCanvasSize(this.width(),this.height());R.draw();this.content.appendChild(R.canvas._canvas);return this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var Q=0;Q<b;Q++){j(this,e[Q])}},_mouseover:function(Q){if(!Kinetic.UA.mobile){this._setPointerPosition(Q);this._fire(H,{evt:Q})}},_mouseout:function(R){if(!Kinetic.UA.mobile){this._setPointerPosition(R);var Q=this.targetShape;if(Q&&!Kinetic.isDragging()){Q._fireAndBubble(O,{evt:R});Q._fireAndBubble(s,{evt:R});this.targetShape=null}this.pointerPos=undefined;this._fire(y,{evt:R})}},_mousemove:function(R){if(!Kinetic.UA.mobile){this._setPointerPosition(R);var Q=Kinetic.DD,S=this.getIntersection(this.getPointerPosition());if(S&&S.isListening()){if(!Kinetic.isDragging()&&(!this.targetShape||this.targetShape._id!==S._id)){if(this.targetShape){this.targetShape._fireAndBubble(O,{evt:R},S);this.targetShape._fireAndBubble(s,{evt:R},S)}S._fireAndBubble(m,{evt:R},this.targetShape);S._fireAndBubble(h,{evt:R},this.targetShape);this.targetShape=S}else{S._fireAndBubble(J,{evt:R})}}else{if(this.targetShape&&!Kinetic.isDragging()){this.targetShape._fireAndBubble(O,{evt:R});this.targetShape._fireAndBubble(s,{evt:R});this.targetShape=null}}this._fire(t,{evt:R});if(Q){Q._drag(R)}}if(R.preventDefault){R.preventDefault()}},_mousedown:function(Q){if(!Kinetic.UA.mobile){this._setPointerPosition(Q);var R=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=true;if(R&&R.isListening()){this.clickStartShape=R;R._fireAndBubble(E,{evt:Q})}this._fire(l,{evt:Q})}if(Q.preventDefault){Q.preventDefault()}},_mouseup:function(R){if(!Kinetic.UA.mobile){this._setPointerPosition(R);var U=this,S=this.getIntersection(this.getPointerPosition()),Q=this.clickStartShape,T=false;if(Kinetic.inDblClickWindow){T=true;Kinetic.inDblClickWindow=false}else{Kinetic.inDblClickWindow=true}setTimeout(function(){Kinetic.inDblClickWindow=false},Kinetic.dblClickWindow);if(S&&S.isListening()){S._fireAndBubble(i,{evt:R});if(Kinetic.listenClickTap&&Q&&Q._id===S._id){S._fireAndBubble(I,{evt:R});if(T){S._fireAndBubble(g,{evt:R})}}}this._fire(q,{evt:R});if(Kinetic.listenClickTap){this._fire(x,{evt:R});if(T){this._fire(z,{evt:R})}}Kinetic.listenClickTap=false}if(R.preventDefault){R.preventDefault()}},_touchstart:function(Q){this._setPointerPosition(Q);var R=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=true;if(R&&R.isListening()){this.tapStartShape=R;R._fireAndBubble(B,{evt:Q});if(R.isListening()&&Q.preventDefault){Q.preventDefault()}}this._fire(v,{evt:Q})},_touchend:function(Q){this._setPointerPosition(Q);var R=this.getIntersection(this.getPointerPosition()),S=false;if(Kinetic.inDblClickWindow){S=true;Kinetic.inDblClickWindow=false}else{Kinetic.inDblClickWindow=true}setTimeout(function(){Kinetic.inDblClickWindow=false},Kinetic.dblClickWindow);if(R&&R.isListening()){R._fireAndBubble(D,{evt:Q});if(Kinetic.listenClickTap&&R._id===this.tapStartShape._id){R._fireAndBubble(k,{evt:Q});if(S){R._fireAndBubble(A,{evt:Q})}}if(R.isListening()&&Q.preventDefault){Q.preventDefault()}}if(Kinetic.listenClickTap){this._fire(r,{evt:Q});if(S){this._fire(G,{evt:Q})}}Kinetic.listenClickTap=false},_touchmove:function(R){this._setPointerPosition(R);var Q=Kinetic.DD,S=this.getIntersection(this.getPointerPosition());if(S&&S.isListening()){S._fireAndBubble(F,{evt:R});if(S.isListening()&&R.preventDefault){R.preventDefault()}}this._fire(n,{evt:R});if(Q){Q._drag(R)}},_setPointerPosition:function(S){var T=this._getContentPosition(),R=S.offsetX,U=S.clientX,Q=null,W=null,V;S=S?S:window.event;if(S.touches!==undefined){if(S.touches.length>0){V=S.touches[0];Q=V.clientX-T.left;W=V.clientY-T.top}}else{if(R!==undefined){Q=R;W=S.offsetY}else{if(Kinetic.UA.browser==="mozilla"){Q=S.layerX;W=S.layerY}else{if(U!==undefined&&T){Q=U-T.left;W=S.clientY-T.top}}}}if(Q!==null&&W!==null){this.pointerPos={x:Q,y:W}}},_getContentPosition:function(){var Q=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:Q.top,left:Q.left}},_buildDOM:function(){var Q=this.getContainer();if(!Q){if(Kinetic.Util.isBrowser()){throw"Stage has not container. But container is required"}else{Q=Kinetic.document.createElement(w)}}Q.innerHTML=o;this.content=Kinetic.document.createElement(w);this.content.style.position=p;this.content.style.display=N;this.content.className=C;this.content.setAttribute("role","presentation");Q.appendChild(this.content);this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1});this.bufferHitCanvas=new Kinetic.HitCanvas();this._resizeDOM()},_onContent:function(S,U){var T=S.split(a),Q=T.length,V,R;for(V=0;V<Q;V++){R=T[V];this.content.addEventListener(R,U,false)}},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.");return},clearCache:function(){}});Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container);Kinetic.Factory.addGetter(Kinetic.Stage,"container");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")})();(function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(a){this.nodeType="Layer";Kinetic.Container.call(this,a)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){this.getContext().clear(a);this.getHitCanvas().getContext().clear(a);return this},setZIndex:function(b){Kinetic.Node.prototype.setZIndex.call(this,b);var a=this.getStage();if(a){a.content.removeChild(this.getCanvas()._canvas);if(b<a.getChildren().length-1){a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[b+1].getCanvas()._canvas)}else{a.content.appendChild(this.getCanvas()._canvas)}}return this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();if(a){a.content.removeChild(this.getCanvas()._canvas);a.content.appendChild(this.getCanvas()._canvas)}},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();if(a){a.content.removeChild(this.getCanvas()._canvas);if(this.index<a.getChildren().length-1){a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas)}else{a.content.appendChild(this.getCanvas()._canvas)}}}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getCanvas()._canvas;Kinetic.Node.prototype.remove.call(this);if(a&&a.parentNode&&Kinetic.Util._isInDocument(a)){a.parentNode.removeChild(a)}return this},getStage:function(){return this.parent}});Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container);Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",true);Kinetic.Collection.mapMethods(Kinetic.BaseLayer)})();(function(){var c="#",b="beforeDraw",e="draw",a=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],d=a.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(f){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas();this.hitCanvas=new Kinetic.HitCanvas();Kinetic.BaseLayer.call(this,f)},_setCanvasSize:function(g,f){this.canvas.setSize(g,f);this.hitCanvas.setSize(g,f)},_validateAdd:function(g){var f=g.getType();if(f!=="Group"&&f!=="Shape"){Kinetic.Util.error("You may only add groups and shapes to a layer.")}},getIntersection:function(k){var j,g,h,f;if(this.hitGraphEnabled()&&this.isVisible()){for(g=0;g<d;g++){h=a[g];j=this._getIntersection({x:k.x+h.x,y:k.y+h.y});f=j.shape;if(f){return f}else{if(!j.antialiased){return null}}}}else{return null}},_getIntersection:function(j){var h=this.hitCanvas.context._context.getImageData(j.x,j.y,1,1).data,g=h[3],i,f;if(g===255){i=Kinetic.Util._rgbToHex(h[0],h[1],h[2]);f=Kinetic.shapes[c+i];return{shape:f}}else{if(g>0){return{antialiased:true}}else{return{}}}},drawScene:function(h,i){var g=this.getLayer(),f=h||(g&&g.getCanvas());this._fire(b,{node:this});if(this.getClearBeforeDraw()){f.getContext().clear()}Kinetic.Container.prototype.drawScene.call(this,f,i);this._fire(e,{node:this});return this},_applyTransform:function(g,h,i){var f=g.getAbsoluteTransform(i).getMatrix();h.transform(f[0],f[1],f[2],f[3],f[4],f[5])},drawHit:function(h,i){var g=this.getLayer(),f=h||(g&&g.hitCanvas);if(g&&g.getClearBeforeDraw()){g.getHitCanvas().getContext().clear()}Kinetic.Container.prototype.drawHit.call(this,f,i);return this},clear:function(f){this.getContext().clear(f);this.getHitCanvas().getContext().clear(f);return this},setVisible:function(f){Kinetic.Node.prototype.setVisible.call(this,f);if(f){this.getCanvas()._canvas.style.display="block";this.hitCanvas._canvas.style.display="block"}else{this.getCanvas()._canvas.style.display="none";this.hitCanvas._canvas.style.display="none"}return this},enableHitGraph:function(){this.setHitGraphEnabled(true);return this},disableHitGraph:function(){this.setHitGraphEnabled(false);return this}});Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",true);Kinetic.Collection.mapMethods(Kinetic.Layer)})();(function(){var b="#",a="beforeDraw",c="draw";Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(d){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas();Kinetic.BaseLayer.call(this,d)},_validateAdd:function(e){var d=e.getType();if(d!=="Shape"){Kinetic.Util.error("You may only add shapes to a fast layer.")}},_setCanvasSize:function(e,d){this.canvas.setSize(e,d)},hitGraphEnabled:function(){return false},getIntersection:function(){return null},drawScene:function(f){var e=this.getLayer(),d=f||(e&&e.getCanvas());if(this.getClearBeforeDraw()){d.getContext().clear()}Kinetic.Container.prototype.drawScene.call(this,d);return this},_applyTransform:function(e,f,g){if(!g||g._id!==this._id){var d=e.getTransform().getMatrix();f.transform(d[0],d[1],d[2],d[3],d[4],d[5])}},draw:function(){this.drawScene();return this},clear:function(d){this.getContext().clear(d);return this},setVisible:function(d){Kinetic.Node.prototype.setVisible.call(this,d);if(d){this.getCanvas()._canvas.style.display="block"}else{this.getCanvas()._canvas.style.display="none"}return this}});Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer);Kinetic.Collection.mapMethods(Kinetic.FastLayer)})();(function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(a){this.nodeType="Group";Kinetic.Container.call(this,a)},_validateAdd:function(b){var a=b.getType();if(a!=="Group"&&a!=="Shape"){Kinetic.Util.error("You may only add groups and shapes to groups.")}}});Kinetic.Util.extend(Kinetic.Group,Kinetic.Container);Kinetic.Collection.mapMethods(Kinetic.Group)})();(function(){Kinetic.Rect=function(a){this.___init(a)};Kinetic.Rect.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Rect";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var b=this.getCornerRadius(),d=this.getWidth(),a=this.getHeight();c.beginPath();if(!b){c.rect(0,0,d,a)}else{c.moveTo(b,0);c.lineTo(d-b,0);c.arc(d-b,b,b,Math.PI*3/2,0,false);c.lineTo(d,a-b);c.arc(d-b,a-b,b,0,Math.PI/2,false);c.lineTo(b,a);c.arc(b,a-b,b,Math.PI/2,Math.PI,false);c.lineTo(0,b);c.arc(b,b,b,Math.PI,Math.PI*3/2,false)}c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Rect)})();(function(){var b=(Math.PI*2)-0.0001,a="Circle";Kinetic.Circle=function(c){this.___init(c)};Kinetic.Circle.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className=a;this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){c.beginPath();c.arc(0,0,this.getRadius(),0,b,false);c.closePath();c.fillStrokeShape(this)},getWidth:function(){return this.getRadius()*2},getHeight:function(){return this.getRadius()*2},setWidth:function(c){Kinetic.Node.prototype.setWidth.call(this,c);this.setRadius(c/2)},setHeight:function(c){Kinetic.Node.prototype.setHeight.call(this,c);this.setRadius(c/2)}};Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0);Kinetic.Collection.mapMethods(Kinetic.Circle)})();(function(){var b=(Math.PI*2)-0.0001,a="Ellipse";Kinetic.Ellipse=function(c){this.___init(c)};Kinetic.Ellipse.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className=a;this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var d=this.getRadius(),f=d.x,e=d.y;c.beginPath();c.save();if(f!==e){c.scale(1,e/f)}c.arc(0,0,f,0,b,false);c.restore();c.closePath();c.fillStrokeShape(this)},getWidth:function(){return this.getRadius().x*2},getHeight:function(){return this.getRadius().y*2},setWidth:function(c){Kinetic.Node.prototype.setWidth.call(this,c);this.setRadius({x:c/2})},setHeight:function(c){Kinetic.Node.prototype.setHeight.call(this,c);this.setRadius({y:c/2})}};Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0);Kinetic.Collection.mapMethods(Kinetic.Ellipse)})();(function(){var a=(Math.PI*2)-0.0001;Kinetic.Ring=function(b){this.___init(b)};Kinetic.Ring.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Ring";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath();b.arc(0,0,this.getInnerRadius(),0,a,false);b.moveTo(this.getOuterRadius(),0);b.arc(0,0,this.getOuterRadius(),a,0,true);b.closePath();b.fillStrokeShape(this)},getWidth:function(){return this.getOuterRadius()*2},getHeight:function(){return this.getOuterRadius()*2},setWidth:function(b){Kinetic.Node.prototype.setWidth.call(this,b);this.setOuterRadius(b/2)},setHeight:function(b){Kinetic.Node.prototype.setHeight.call(this,b);this.setOuterRadius(b/2)}};Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Ring)})();(function(){Kinetic.Wedge=function(a){this.___init(a)};Kinetic.Wedge.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Wedge";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise());a.lineTo(0,0);a.closePath();a.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",false);Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});Kinetic.Collection.mapMethods(Kinetic.Wedge)})();(function(){var a=Math.PI/180;Kinetic.Arc=function(b){this.___init(b)};Kinetic.Arc.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className="Arc";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var d=Kinetic.getAngle(this.angle()),b=this.clockwise();c.beginPath();c.arc(0,0,this.getOuterRadius(),0,d,b);c.arc(0,0,this.getInnerRadius(),d,0,!b);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",false);Kinetic.Collection.mapMethods(Kinetic.Arc)})();(function(){var a="Image";Kinetic.Image=function(b){this.___init(b)};Kinetic.Image.prototype={___init:function(b){Kinetic.Shape.call(this,b);this.className=a;this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},_sceneFunc:function(d){var g=this.getWidth(),b=this.getHeight(),h=this.getImage(),f,e,c,i;if(h){f=this.getCrop();e=f.width;c=f.height;if(e&&c){i=[h,f.x,f.y,e,c,0,0,g,b]}else{i=[h,0,0,g,b]}}d.beginPath();d.rect(0,0,g,b);d.closePath();d.fillStrokeShape(this);if(h){d.drawImage.apply(d,i)}},_hitFunc:function(c){var d=this.getWidth(),b=this.getHeight();c.beginPath();c.rect(0,0,d,b);c.closePath();c.fillStrokeShape(this)},getWidth:function(){var b=this.getImage();return this.attrs.width||(b?b.width:0)},getHeight:function(){var b=this.getImage();return this.attrs.height||(b?b.height:0)}};Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Image,"image");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0);Kinetic.Collection.mapMethods(Kinetic.Image)})();(function(){var n="auto",v="center",g="Change.kinetic",c="2d",r="-",a="",l="left",s="text",k="Text",h="middle",i="normal",q="px ",f=" ",j="right",b="word",d="char",e="none",m=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],u=m.length,p=Kinetic.Util.createCanvasElement().getContext(c);Kinetic.Text=function(w){this.___init(w)};function o(w){w.fillText(this.partialText,0,0)}function t(w){w.strokeText(this.partialText,0,0)}Kinetic.Text.prototype={___init:function(w){var x=this;if(w.width===undefined){w.width=n}if(w.height===undefined){w.height=n}Kinetic.Shape.call(this,w);this._fillFunc=o;this._strokeFunc=t;this.className=k;for(var y=0;y<u;y++){this.on(m[y]+g,x._setTextData)}this._setTextData();this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(y){var x=this.getPadding(),E=this.getTextHeight(),A=this.getLineHeight()*E,F=this.textArr,D=F.length,C=this.getWidth(),z;y.setAttr("font",this._getContextFont());y.setAttr("textBaseline",h);y.setAttr("textAlign",l);y.save();y.translate(x,0);y.translate(0,x+E/2);for(z=0;z<D;z++){var B=F[z],G=B.text,w=B.width;y.save();if(this.getAlign()===j){y.translate(C-w-x*2,0)}else{if(this.getAlign()===v){y.translate((C-w-x*2)/2,0)}}this.partialText=G;y.fillStrokeShape(this);y.restore();y.translate(0,A)}y.restore()},_hitFunc:function(x){var y=this.getWidth(),w=this.getHeight();x.beginPath();x.rect(0,0,y,w);x.closePath();x.fillStrokeShape(this)},setText:function(x){var w=Kinetic.Util._isString(x)?x:x.toString();this._setAttr(s,w);return this},getWidth:function(){return this.attrs.width===n?this.getTextWidth()+this.getPadding()*2:this.attrs.width},getHeight:function(){return this.attrs.height===n?(this.getTextHeight()*this.textArr.length*this.getLineHeight())+this.getPadding()*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(z){var w=p,y=this.getFontSize(),x;w.save();w.font=this._getContextFont();x=w.measureText(z);w.restore();return{width:x.width,height:parseInt(y,10)}},_getContextFont:function(){return this.getFontStyle()+f+this.getFontVariant()+f+this.getFontSize()+q+this.getFontFamily()},_addTextLine:function(w,x){return this.textArr.push({text:w,width:x})},_getTextWidth:function(w){return p.measureText(w).width},_setTextData:function(){var x=this.getText().split("\n"),z=+this.getFontSize(),A=0,V=this.getLineHeight()*z,L=this.attrs.width,J=this.attrs.height,Q=L!==n,S=J!==n,H=this.getPadding(),R=L-H*2,G=J-H*2,M=0,D=this.getWrap(),y=D!==e,K=D!==d&&y;this.textArr=[];p.save();p.font=this._getContextFont();for(var P=0,O=x.length;P<O;++P){var F=x[P],w=this._getTextWidth(F);if(Q&&w>R){while(F.length>0){var W=0,C=F.length,B="",E=0;while(W<C){var U=(W+C)>>>1,I=F.slice(0,U+1),T=this._getTextWidth(I);if(T<=R){W=U+1;B=I;E=T}else{C=U}}if(B){if(K){var N=Math.max(B.lastIndexOf(f),B.lastIndexOf(r))+1;if(N>0){W=N;B=B.slice(0,W);E=this._getTextWidth(B)}}this._addTextLine(B,E);A=Math.max(A,E);M+=V;if(!y||(S&&M+V>G)){break}F=F.slice(W);if(F.length>0){w=this._getTextWidth(F);if(w<=R){this._addTextLine(F,w);M+=V;A=Math.max(A,w);break}}}else{break}}}else{this._addTextLine(F,w);M+=V;A=Math.max(A,w)}if(S&&M+V>G){break}}p.restore();this.textHeight=z;this.textWidth=A}};Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",i);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant",i);Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0);Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",l);Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1);Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",b);Kinetic.Factory.addGetter(Kinetic.Text,"text",a);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text");Kinetic.Collection.mapMethods(Kinetic.Text)})();(function(){Kinetic.Line=function(a){this.___init(a)};Kinetic.Line.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Line";this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){var e=this.getPoints(),f=e.length,c=this.getTension(),b=this.getClosed(),g,a,h;d.beginPath();d.moveTo(e[0],e[1]);if(c!==0&&f>4){g=this.getTensionPoints();a=g.length;h=b?0:4;if(!b){d.quadraticCurveTo(g[0],g[1],g[2],g[3])}while(h<a-2){d.bezierCurveTo(g[h++],g[h++],g[h++],g[h++],g[h++],g[h++])}if(!b){d.quadraticCurveTo(g[a-2],g[a-1],e[f-2],e[f-1])}}else{for(h=2;h<f;h+=2){d.lineTo(e[h],e[h+1])}}if(b){d.closePath();d.fillStrokeShape(this)}else{d.strokeShape(this)}},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){if(this.getClosed()){return this._getTensionPointsClosed()}else{return Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}},_getTensionPointsClosed:function(){var g=this.getPoints(),c=g.length,f=this.getTension(),d=Kinetic.Util,b=d._getControlPoints(g[c-2],g[c-1],g[0],g[1],g[2],g[3],f),a=d._getControlPoints(g[c-4],g[c-3],g[c-2],g[c-1],g[0],g[1],f),e=Kinetic.Util._expandPoints(g,f),h=[b[2],b[3]].concat(e).concat([a[0],a[1],g[c-2],g[c-1],a[2],a[3],b[0],b[1],g[0],g[1]]);return h}};Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",false);Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0);Kinetic.Factory.addGetterSetter(Kinetic.Line,"points");Kinetic.Collection.mapMethods(Kinetic.Line)})();(function(){Kinetic.Sprite=function(a){this.___init(a)};Kinetic.Sprite.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Sprite";this.anim=new Kinetic.Animation();this.on("animationChange.kinetic",function(){this.frameIndex(0)});this.on("frameRateChange.kinetic",function(){if(!this.anim.isRunning()){return}clearInterval(this.interval);this._setInterval()});this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(b){var d=this.getAnimation(),e=this.frameIndex(),i=e*4,h=this.getAnimations()[d],g=h[i+0],f=h[i+1],a=h[i+2],j=h[i+3],c=this.getImage();if(c){b.drawImage(c,g,f,a,j,0,0,a,j)}},_hitFunc:function(c){var e=this.getAnimation(),b=this.frameIndex(),f=b*4,g=this.getAnimations()[e],d=g[f+2],a=g[f+3];c.beginPath();c.rect(0,0,d,a);c.closePath();c.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},_setInterval:function(){var a=this;this.interval=setInterval(function(){a._updateIndex()},1000/this.getFrameRate())},start:function(){var a=this.getLayer();this.anim.setLayers(a);this._setInterval();this.anim.start()},stop:function(){this.anim.stop();clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var b=this.frameIndex(),d=this.getAnimation(),e=this.getAnimations(),c=e[d],a=c.length/4;if(b<a-1){this.frameIndex(b+1)}else{this.frameIndex(0)}}};Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17);Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});Kinetic.Collection.mapMethods(Kinetic.Sprite)})();(function(){Kinetic.Path=function(a){this.___init(a)};Kinetic.Path.prototype={___init:function(a){this.dataArray=[];var b=this;Kinetic.Shape.call(this,a);this.className="Path";this.dataArray=Kinetic.Path.parsePathData(this.getData());this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.getData())});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(f){var j=this.dataArray,m=false;f.beginPath();for(var h=0;h<j.length;h++){var q=j[h].command;var e=j[h].points;switch(q){case"L":f.lineTo(e[0],e[1]);break;case"M":f.moveTo(e[0],e[1]);break;case"C":f.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"Q":f.quadraticCurveTo(e[0],e[1],e[2],e[3]);break;case"A":var k=e[0],i=e[1],d=e[2],b=e[3],g=e[4],o=e[5],s=e[6],l=e[7];var a=(d>b)?d:b;var u=(d>b)?1:d/b;var t=(d>b)?b/d:1;f.translate(k,i);f.rotate(s);f.scale(u,t);f.arc(0,0,a,g,g+o,1-l);f.scale(1/u,1/t);f.rotate(-s);f.translate(-k,-i);break;case"z":f.closePath();m=true;break}}if(m){f.fillStrokeShape(this)}else{f.strokeShape(this)}}};Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape);Kinetic.Path.getLineLength=function(b,d,a,c){return Math.sqrt((a-b)*(a-b)+(c-d)*(c-d))};Kinetic.Path.getPointOnLine=function(k,c,a,p,l,o,n){if(o===undefined){o=c}if(n===undefined){n=a}var f=(l-a)/((p-c)+1e-8);var h=Math.sqrt(k*k/(1+f*f));if(p<c){h*=-1}var j=f*h;var r;if(p===c){r={x:o,y:n+j}}else{if((n-a)/((o-c)+1e-8)===f){r={x:o+h,y:n+j}}else{var e,d;var i=this.getLineLength(c,a,p,l);if(i<1e-8){return undefined}var q=(((o-c)*(p-c))+((n-a)*(l-a)));q=q/(i*i);e=c+q*(p-c);d=a+q*(l-a);var g=this.getLineLength(o,n,e,d);var b=Math.sqrt(k*k-g*g);h=Math.sqrt(b*b/(1+f*f));if(p<c){h*=-1}j=f*h;r={x:e+h,y:d+j}}}return r};Kinetic.Path.getPointOnCubicBezier=function(o,d,b,n,l,i,g,c,a){function j(p){return p*p*p}function h(p){return 3*p*p*(1-p)}function f(p){return 3*p*(1-p)*(1-p)}function e(p){return(1-p)*(1-p)*(1-p)}var m=c*j(o)+i*h(o)+n*f(o)+d*e(o);var k=a*j(o)+g*h(o)+l*f(o)+b*e(o);return{x:m,y:k}};Kinetic.Path.getPointOnQuadraticBezier=function(l,b,a,k,i,e,c){function g(m){return m*m}function f(m){return 2*m*(1-m)}function d(m){return(1-m)*(1-m)}var j=e*g(l)+k*f(l)+b*d(l);var h=c*g(l)+i*f(l)+a*d(l);return{x:j,y:h}};Kinetic.Path.getPointOnEllipticalArc=function(f,e,b,a,c,h){var g=Math.cos(h),d=Math.sin(h);var i={x:b*Math.cos(c),y:a*Math.sin(c)};return{x:f+(i.x*g-i.y*d),y:e+(i.x*d+i.y*g)}};Kinetic.Path.parsePathData=function(G){if(!G){return[]}var f=G;var o=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];f=f.replace(new RegExp(" ","g"),",");for(var t=0;t<o.length;t++){f=f.replace(new RegExp(o[t],"g"),"|"+o[t])}var a=f.split("|");var r=[];var j=0;var h=0;for(t=1;t<a.length;t++){var u=a[t];var D=u.charAt(0);u=u.slice(1);u=u.replace(new RegExp(",-","g"),"-");u=u.replace(new RegExp("-","g"),",-");u=u.replace(new RegExp("e,-","g"),"e-");var q=u.split(",");if(q.length>0&&q[0]===""){q.shift()}for(var y=0;y<q.length;y++){q[y]=parseFloat(q[y])}while(q.length>0){if(isNaN(q[0])){break}var w=null;var x=[];var B=j,A=h;var v,F,E;var e,d,C,s,g,z,b;switch(D){case"l":j+=q.shift();h+=q.shift();w="L";x.push(j,h);break;case"L":j=q.shift();h=q.shift();x.push(j,h);break;case"m":var l=q.shift();var k=q.shift();j+=l;h+=k;w="M";if(r.length>2&&r[r.length-1].command==="z"){for(var m=r.length-2;m>=0;m--){if(r[m].command==="M"){j=r[m].points[0]+l;h=r[m].points[1]+k;break}}}x.push(j,h);D="l";break;case"M":j=q.shift();h=q.shift();w="M";x.push(j,h);D="L";break;case"h":j+=q.shift();w="L";x.push(j,h);break;case"H":j=q.shift();w="L";x.push(j,h);break;case"v":h+=q.shift();w="L";x.push(j,h);break;case"V":h=q.shift();w="L";x.push(j,h);break;case"C":x.push(q.shift(),q.shift(),q.shift(),q.shift());j=q.shift();h=q.shift();x.push(j,h);break;case"c":x.push(j+q.shift(),h+q.shift(),j+q.shift(),h+q.shift());j+=q.shift();h+=q.shift();w="C";x.push(j,h);break;case"S":F=j;E=h;v=r[r.length-1];if(v.command==="C"){F=j+(j-v.points[2]);E=h+(h-v.points[3])}x.push(F,E,q.shift(),q.shift());j=q.shift();h=q.shift();w="C";x.push(j,h);break;case"s":F=j;E=h;v=r[r.length-1];if(v.command==="C"){F=j+(j-v.points[2]);E=h+(h-v.points[3])}x.push(F,E,j+q.shift(),h+q.shift());j+=q.shift();h+=q.shift();w="C";x.push(j,h);break;case"Q":x.push(q.shift(),q.shift());j=q.shift();h=q.shift();x.push(j,h);break;case"q":x.push(j+q.shift(),h+q.shift());j+=q.shift();h+=q.shift();w="Q";x.push(j,h);break;case"T":F=j;E=h;v=r[r.length-1];if(v.command==="Q"){F=j+(j-v.points[0]);E=h+(h-v.points[1])}j=q.shift();h=q.shift();w="Q";x.push(F,E,j,h);break;case"t":F=j;E=h;v=r[r.length-1];if(v.command==="Q"){F=j+(j-v.points[0]);E=h+(h-v.points[1])}j+=q.shift();h+=q.shift();w="Q";x.push(F,E,j,h);break;case"A":e=q.shift();d=q.shift();C=q.shift();s=q.shift();g=q.shift();z=j;b=h;j=q.shift();h=q.shift();w="A";x=this.convertEndpointToCenterParameterization(z,b,j,h,s,g,e,d,C);break;case"a":e=q.shift();d=q.shift();C=q.shift();s=q.shift();g=q.shift();z=j;b=h;j+=q.shift();h+=q.shift();w="A";x=this.convertEndpointToCenterParameterization(z,b,j,h,s,g,e,d,C);break}r.push({command:w||D,points:x,start:{x:B,y:A},pathLength:this.calcLength(B,A,w||D,x)})}if(D==="z"||D==="Z"){r.push({command:"z",points:[],start:undefined,pathLength:0})}}return r};Kinetic.Path.calcLength=function(h,g,c,j){var e,k,i,l;var m=Kinetic.Path;switch(c){case"L":return m.getLineLength(h,g,j[0],j[1]);case"C":e=0;k=m.getPointOnCubicBezier(0,h,g,j[0],j[1],j[2],j[3],j[4],j[5]);for(l=0.01;l<=1;l+=0.01){i=m.getPointOnCubicBezier(l,h,g,j[0],j[1],j[2],j[3],j[4],j[5]);e+=m.getLineLength(k.x,k.y,i.x,i.y);k=i}return e;case"Q":e=0;k=m.getPointOnQuadraticBezier(0,h,g,j[0],j[1],j[2],j[3]);for(l=0.01;l<=1;l+=0.01){i=m.getPointOnQuadraticBezier(l,h,g,j[0],j[1],j[2],j[3]);e+=m.getLineLength(k.x,k.y,i.x,i.y);k=i}return e;case"A":e=0;var a=j[4];var f=j[5];var d=j[4]+f;var b=Math.PI/180;if(Math.abs(a-d)<b){b=Math.abs(a-d)}k=m.getPointOnEllipticalArc(j[0],j[1],j[2],j[3],a,0);if(f<0){for(l=a-b;l>d;l-=b){i=m.getPointOnEllipticalArc(j[0],j[1],j[2],j[3],l,0);e+=m.getLineLength(k.x,k.y,i.x,i.y);k=i}}else{for(l=a+b;l<d;l+=b){i=m.getPointOnEllipticalArc(j[0],j[1],j[2],j[3],l,0);e+=m.getLineLength(k.x,k.y,i.x,i.y);k=i}}i=m.getPointOnEllipticalArc(j[0],j[1],j[2],j[3],d,0);e+=m.getLineLength(k.x,k.y,i.x,i.y);return e}return 0};Kinetic.Path.convertEndpointToCenterParameterization=function(w,d,t,c,s,k,j,i,g){var A=g*(Math.PI/180);var m=Math.cos(A)*(w-t)/2+Math.sin(A)*(d-c)/2;var x=-1*Math.sin(A)*(w-t)/2+Math.cos(A)*(d-c)/2;var p=(m*m)/(j*j)+(x*x)/(i*i);if(p>1){j*=Math.sqrt(p);i*=Math.sqrt(p)}var z=Math.sqrt((((j*j)*(i*i))-((j*j)*(x*x))-((i*i)*(m*m)))/((j*j)*(x*x)+(i*i)*(m*m)));if(s===k){z*=-1}if(isNaN(z)){z=0}var h=z*j*x/i;var q=z*-i*m/j;var e=(w+t)/2+Math.cos(A)*h-Math.sin(A)*q;var b=(d+c)/2+Math.sin(A)*h+Math.cos(A)*q;var B=function(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])};var a=function(C,f){return(C[0]*f[0]+C[1]*f[1])/(B(C)*B(f))};var r=function(C,f){return(C[0]*f[1]<C[1]*f[0]?-1:1)*Math.acos(a(C,f))};var l=r([1,0],[(m-h)/j,(x-q)/i]);var o=[(m-h)/j,(x-q)/i];var n=[(-1*m-h)/j,(-1*x-q)/i];var y=r(o,n);if(a(o,n)<=-1){y=Math.PI}if(a(o,n)>=1){y=0}if(k===0&&y>0){y=y-2*Math.PI}if(k===1&&y<0){y=y+2*Math.PI}return[e,b,j,i,l,y,A,k]};Kinetic.Factory.addGetterSetter(Kinetic.Path,"data");Kinetic.Collection.mapMethods(Kinetic.Path)})();(function(){var b="",d="normal";Kinetic.TextPath=function(e){this.___init(e)};function a(e){e.fillText(this.partialText,0,0)}function c(e){e.strokeText(this.partialText,0,0)}Kinetic.TextPath.prototype={___init:function(e){var f=this;this.dummyCanvas=Kinetic.Util.createCanvasElement();this.dataArray=[];Kinetic.Shape.call(this,e);this._fillFunc=a;this._strokeFunc=c;this._fillFuncHit=a;this._strokeFuncHit=c;this.className="TextPath";this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange.kinetic",function(){f.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",f._setTextData);f._setTextData();this.sceneFunc(this._sceneFunc)},_sceneFunc:function(g){g.setAttr("font",this._getContextFont());g.setAttr("textBaseline","middle");g.setAttr("textAlign","left");g.save();var e=this.glyphInfo;for(var f=0;f<e.length;f++){g.save();var h=e[f].p0;g.translate(h.x,h.y);g.rotate(e[f].rotation);this.partialText=e[f].text;g.fillStrokeShape(this);g.restore()}g.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(h){var g=this.dummyCanvas;var e=g.getContext("2d");e.save();e.font=this._getContextFont();var f=e.measureText(h);e.restore();return{width:f.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var j=this;var t=this._getTextSize(this.attrs.text);this.textWidth=t.width;this.textHeight=t.height;this.glyphInfo=[];var s=this.attrs.text.split("");var r,o,k;var m=-1;var f=0;var h=function(){f=0;var v=j.dataArray;for(var u=m+1;u<v.length;u++){if(v[u].pathLength>0){m=u;return v[u]}else{if(v[u].command=="M"){r={x:v[u].points[0],y:v[u].points[1]}}}}return{}};var n=function(y){var A=j._getTextSize(y).width;var w=0;var B=0;o=undefined;while(Math.abs(A-w)/A>0.01&&B<25){B++;var v=w;while(k===undefined){k=h();if(k&&v+k.pathLength<A){v+=k.pathLength;k=undefined}}if(k==={}||r===undefined){return undefined}var z=false;switch(k.command){case"L":if(Kinetic.Path.getLineLength(r.x,r.y,k.points[0],k.points[1])>A){o=Kinetic.Path.getPointOnLine(A,r.x,r.y,k.points[0],k.points[1],r.x,r.y)}else{k=undefined}break;case"A":var i=k.points[4];var x=k.points[5];var u=k.points[4]+x;if(f===0){f=i+1e-8}else{if(A>w){f+=(Math.PI/180)*x/Math.abs(x)}else{f-=Math.PI/360*x/Math.abs(x)}}if(x<0&&f<u||x>=0&&f>u){f=u;z=true}o=Kinetic.Path.getPointOnEllipticalArc(k.points[0],k.points[1],k.points[2],k.points[3],f,k.points[6]);break;case"C":if(f===0){if(A>k.pathLength){f=1e-8}else{f=A/k.pathLength}}else{if(A>w){f+=(A-w)/k.pathLength}else{f-=(w-A)/k.pathLength}}if(f>1){f=1;z=true}o=Kinetic.Path.getPointOnCubicBezier(f,k.start.x,k.start.y,k.points[0],k.points[1],k.points[2],k.points[3],k.points[4],k.points[5]);break;case"Q":if(f===0){f=A/k.pathLength}else{if(A>w){f+=(A-w)/k.pathLength}else{f-=(w-A)/k.pathLength}}if(f>1){f=1;z=true}o=Kinetic.Path.getPointOnQuadraticBezier(f,k.start.x,k.start.y,k.points[0],k.points[1],k.points[2],k.points[3]);break}if(o!==undefined){w=Kinetic.Path.getLineLength(r.x,r.y,o.x,o.y)}if(z){z=false;k=undefined}}};for(var g=0;g<s.length;g++){n(s[g]);if(r===undefined||o===undefined){break}var e=Kinetic.Path.getLineLength(r.x,r.y,o.x,o.y);var l=0;var q=Kinetic.Path.getPointOnLine(l+e/2,r.x,r.y,o.x,o.y);var p=Math.atan2((o.y-r.y),(o.x-r.x));this.glyphInfo.push({transposeX:q.x,transposeY:q.y,text:s[g],rotation:p,p0:r,p1:o});r=o}}};Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont;Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",d);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant",d);Kinetic.Factory.addGetter(Kinetic.TextPath,"text",b);Kinetic.Collection.mapMethods(Kinetic.TextPath)})();(function(){Kinetic.RegularPolygon=function(a){this.___init(a)};Kinetic.RegularPolygon.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="RegularPolygon";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var d=this.attrs.sides,b=this.attrs.radius,f,a,e;c.beginPath();c.moveTo(0,0-b);for(f=1;f<d;f++){a=b*Math.sin(f*2*Math.PI/d);e=-1*b*Math.cos(f*2*Math.PI/d);c.lineTo(a,e)}c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0);Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)})();(function(){Kinetic.Star=function(a){this.___init(a)};Kinetic.Star.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Star";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var f=this.innerRadius(),e=this.outerRadius(),d=this.numPoints();c.beginPath();c.moveTo(0,0-e);for(var h=1;h<d*2;h++){var b=h%2===0?e:f;var a=b*Math.sin(h*Math.PI/d);var g=-1*b*Math.cos(h*Math.PI/d);c.lineTo(a,g)}c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5);Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Star)})();(function(){var c=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],d="Change.kinetic",g="none",i="up",f="right",h="down",b="left",e="Label",a=c.length;Kinetic.Label=function(j){this.____init(j)};Kinetic.Label.prototype={____init:function(j){var k=this;this.className=e;Kinetic.Group.call(this,j);this.on("add.kinetic",function(l){k._addListeners(l.child);k._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(l){var k=this,m;var j=function(){k._sync()};for(m=0;m<a;m++){l.on(c[m]+d,j)}},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var p=this.getText(),r=this.getTag(),j,q,o,m,n,l,k;if(p&&r){j=p.getWidth();q=p.getHeight();o=r.getPointerDirection();m=r.getPointerWidth();k=r.getPointerHeight();n=0;l=0;switch(o){case i:n=j/2;l=-1*k;break;case f:n=j+m;l=q/2;break;case h:n=j/2;l=q+k;break;case b:n=-1*m;l=q/2;break}r.setAttrs({x:-1*n,y:-1*l,width:j,height:q});p.setAttrs({x:-1*n,y:-1*l})}}};Kinetic.Util.extend(Kinetic.Label,Kinetic.Group);Kinetic.Collection.mapMethods(Kinetic.Label);Kinetic.Tag=function(j){this.___init(j)};Kinetic.Tag.prototype={___init:function(j){Kinetic.Shape.call(this,j);this.className="Tag";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(m){var n=this.getWidth(),j=this.getHeight(),o=this.getPointerDirection(),l=this.getPointerWidth(),k=this.getPointerHeight();m.beginPath();m.moveTo(0,0);if(o===i){m.lineTo((n-l)/2,0);m.lineTo(n/2,-1*k);m.lineTo((n+l)/2,0)}m.lineTo(n,0);if(o===f){m.lineTo(n,(j-k)/2);m.lineTo(n+l,j/2);m.lineTo(n,(j+k)/2)}m.lineTo(n,j);if(o===h){m.lineTo((n+l)/2,j);m.lineTo(n/2,j+k);m.lineTo((n-l)/2,j)}m.lineTo(0,j);if(o===b){m.lineTo(0,(j+k)/2);m.lineTo(-1*l,j/2);m.lineTo(0,(j-k)/2)}m.closePath();m.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",g);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Tag)})();